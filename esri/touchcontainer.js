/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox"],function(_1,_2,_3){_2.provide("esri.touchcontainer");_2.declare("esri._MapContainer",esri._CoreMap,(function(){var _4=_2.connect,_5=_2.disconnect,_6=esri.geometry.Point;var _7=300;return {constructor:function(){this._onTouchStart_connect=_4(this.__container,"ontouchstart",this,this._onTouchStartHandler);this._gestureStartConnect=_4(this.__container,"ongesturestart",this,this._onGestureStartHandler);this._connects.push(_4(this.__container,"onmouseover",this,this._onMouseOverHandler));this._connects.push(_4(this.__container,"onmouseout",this,this._onMouseOutHandler));this._connects.push(_4(this.__container,"onmousedown",this,this._onMouseDownHandler));this._connects.push(_4(this.__container,"onmouseup",this,this._onMouseUpHandler));this._connects.push(_4(this.__container,"onclick",this,this._onClickHandler));this._endX=this._endY=0;this._firstTapOn=false;this._processDoubleTap=false;this._processMultiTouchTap=false;this._doubleTapTimeoutObject=false;this._doubleTapTimeout=_2.hitch(this,this._doubleTapTimeout);},_doubleTapTimeout:function(){this._firstTapOn=false;},_cleanUp:function(){var i;for(i=this._connects.length;i>=0;i--){_5(this._connects[i]);delete this._connects[i];}_5(this._onTouchMoveHandler_connect);_5(this._onTouchEndHandler_connect);_5(this._onTouchCancelHandler_connect);this.inherited("_cleanUp",arguments);},__setClickDuration:function(_8){this._clickDuration=_8;},__resetClickDuration:function(){this._clickDuration=_7;},_processEvent:function(_9){if(_9.type.indexOf("touch")!==-1){if(_9.touches.length===2){_9.screenPoints=[new _6(_9.touches.item(0).pageX-this.position.x,_9.touches.item(0).pageY-this.position.y),new _6(_9.touches.item(1).pageX-this.position.x,_9.touches.item(1).pageY-this.position.y)];return _9;}else{if(_9.type==="touchstart"){_9.screenPoint=new _6(_9.targetTouches.item(0).pageX-this.position.x,_9.targetTouches.item(0).pageY-this.position.y);}else{_9.screenPoint=new _6(_9.changedTouches.item(0).pageX-this.position.x,_9.changedTouches.item(0).pageY-this.position.y);}_9.mapPoint=this.extent?this.toMap(_9.screenPoint):new _6();return _9;}}_9.screenPoint=new _6(_9.pageX-this.position.x,_9.pageY-this.position.y);_9.mapPoint=this.extent?this.toMap(_9.screenPoint):new _6();return _9;},_onClickHandler:function(_a){_a=this._processEvent(_a);var dx=Math.abs(this._endX-_a.screenPoint.x);var dy=Math.abs(this._endY-_a.screenPoint.y);if(esri.isBlackBerry){clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;if(!this._tmoved){this.onClick(_a);}}else{if(dx<=1&&dy<=1){var ts=(new Date()).getTime(),_b=this._clkTS&&((ts-this._clkTS)<=400),_c=_b&&Math.abs(this._lastClickX-_a.pageX),_d=_b&&Math.abs(this._lastClickY-_a.pageY);clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;this.onClick(_a);if(esri.isAndroid&&_b&&_c<=15&&_d<=15){this.onDblClick(_a);this._processDoubleTap=false;}}}},_onMouseOverHandler:function(_e){_e=this._processEvent(_e);this.onMouseOver(_e);},_onMouseOutHandler:function(_f){_f=this._processEvent(_f);this.onMouseOut(_f);},_onMouseDownHandler:function(evt){evt=this._processEvent(evt);this.onMouseDown(evt);},_onMouseUpHandler:function(evt){evt=this._processEvent(evt);this.onMouseUp(evt);},_onTouchStartHandler:function(evt){var _10;if(this._firstTapOn){if(esri.isBlackBerry){if(this._lastTouchEvent==="touchend"){this._processDoubleTap=true;clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;_10=1;}}else{this._processDoubleTap=true;clearTimeout(this._doubleTapTimeoutObject);this._firstTapOn=false;}}else{this._firstTapOn=true;this._doubleTapTimeoutObject=setTimeout(this._doubleTapTimeout,400);}this._lastTouchEvent="touchstart";evt=this._processEvent(evt);this._tmoved=false;_5(this._onTouchMoveHandler_connect);_5(this._onTouchEndHandler_connect);_5(this._onTouchCancelHandler_connect);this._onTouchMoveHandler_connect=_4(this.__container,"ontouchmove",this,this._onTouchMoveHandler);this._onTouchEndHandler_connect=_4(this.__container,"ontouchend",this,this._onTouchEndHandler);this._onTouchCancelHandler_connect=_4(this.__container,"ontouchcancel",this,this._onTouchEndHandler);this.onTouchStart(evt);if(_10){this._onTouchEndHandler(evt);}},_onTouchMoveHandler:function(evt){this._tmoved=true;this.onTouchMove(this._processEvent(evt));},_onTouchEndHandler:function(evt){_5(this._onTouchMoveHandler_connect);_5(this._onTouchEndHandler_connect);_5(this._onTouchCancelHandler_connect);this._lastTouchEvent="touchend";evt=this._processEvent(evt);var dx=Math.abs(this._endX-evt.screenPoint.x),dy=Math.abs(this._endY-evt.screenPoint.y);this._endX=evt.screenPoint.x;this._endY=evt.screenPoint.y;this.onTouchEnd(evt);if(this._processDoubleTap){if(dx<=15&&dy<=15){this.onDblClick(evt);}this._processDoubleTap=false;}},_onGestureStartHandler:function(evt){_5(this._onTouchStart_connect);_5(this._gestureStartConnect);_5(this._onTouchMoveHandler_connect);_5(this._onTouchEndHandler_connect);_5(this._onTouchCancelHandler_connect);this._processMultiTouchTap=true;this._onTouchMoveHandler_connect=_4(this.__container,"ontouchmove",this,this._onGestureTouchMoveHandler);this._onTouchEndHandler_connect=_4(this.__container,"ontouchend",this,this._onGestureTouchEndHandler);this._onTouchCancelHandler_connect=_4(this.__container,"ontouchcancel",this,this._onGestureTouchEndHandler);this.onGestureStart(this._processEvent(evt));},_onGestureTouchMoveHandler:function(evt){this._processMultiTouchTap=false;this.onGestureChange(this._processEvent(evt));},_onGestureTouchEndHandler:function(evt){_5(this._onTouchMoveHandler_connect);_5(this._onTouchEndHandler_connect);_5(this._onTouchCancelHandler_connect);this._onTouchStart_connect=_4(this.__container,"ontouchstart",this,this._onTouchStartHandler);this._gestureStartConnect=_4(this.__container,"ongesturestart",this,this._onGestureStartHandler);if(this._processMultiTouchTap){evt.processMultiTouchTap=true;this._processMultiTouchTap=false;}this.onGestureEnd(this._processEvent(evt));},onClick:function(evt){this._clkTS=(new Date()).getTime();this._lastClickX=evt.pageX;this._lastClickY=evt.pageY;},onMouseOver:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onTouchStart:function(){},onTouchMove:function(){},onTouchEnd:function(){},onGestureStart:function(){},onGestureChange:function(){},onGestureEnd:function(){}};}()));});