/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/layers/layer,dojox/gfx,esri/graphic,esri/renderer"],function(_1,_2,_3){_2.provide("esri.layers.graphics");_2.require("esri.layers.layer");_2.require("dojox.gfx");_2.require("esri.graphic");_2.require("esri.renderer");if(_3.gfx.renderer==="vml"){esri.vml=true;_2.addOnLoad(function(){_2.declare("esri.gfx.Path",_3.gfx.Path,{setShape:function(_4){this.rawNode.path.v=(this.vmlPath=_4);return this;}});esri.gfx.Path.nodeType="shape";var _5=_3.gfx.Shape||_3.gfx.vml.Shape,_6=_5.prototype.setStroke;_5.prototype.setStroke=function(){var _7=_6.apply(this,arguments);var _8=this.rawNode,_9=_8&&_8.stroke,_a=this.getParent();if(_9&&_a){var op=esri._isDefined(_a._esriIeOpacity)?_a._esriIeOpacity:1;_9.opacity*=op;}return _7;};var _b=_5.prototype.setFill;_5.prototype.setFill=function(){var _c=_b.apply(this,arguments);var _d=this.rawNode,_e=_d&&_d.fill,_f=this.getParent();if(_e&&_f){var op=esri._isDefined(_f._esriIeOpacity)?_f._esriIeOpacity:1;if(_e.type==="tile"){_2.style(_d,"opacity",op);}else{_e.opacity*=op;}}return _c;};});}_2.declare("esri.layers._GraphicsContainer",null,{_setMap:function(map,_10){var es,_11=(this._connects=[]);this._map=map;if(_3.gfx.renderer==="canvas"){es=_2.create("div",{style:"overflow: visible; position: absolute;"},_10);this._surface={getEventSource:function(){return es;}};_11.push(_2.connect(es,"onmousedown",this,this._canvasDownHandler));_11.push(_2.connect(es,"onmouseup",this,this._canvasUpHandler));_11.push(_2.connect(es,"onclick",this,this._canvasClickHandler));esri.layers._GraphicsLayer.prototype._canvas=true;}else{var _12=(this._surface=_3.gfx.createSurface(_10,map.width,map.height));es=_12.getEventSource();_2.style((es=esri.vml?es.parentNode:es),{overflow:"visible",position:"absolute"});}_11.push(_2.connect(map,"onResize",this,"_onResizeHandler"));return es;},_onResizeHandler:function(_13,_14,_15){var es=this._surface.getEventSource(),map=this._map,_16;if(esri.vml){_2.style((es=es.parentNode),{width:_14+"px",height:_15+"px",clip:"rect(0px "+_14+"px "+_15+"px 0px)"});}_2.attr(es,"width",_14);_2.attr(es,"height",_15);if(!this._surface.declaredClass){_2.forEach(es.childNodes,function(_17){_2.attr(_17,"width",_14);_2.attr(_17,"height",_15);});}if(map.loaded){if(!map.graphics._suspended){map.graphics._resized=true;}_2.forEach(map.graphicsLayerIds,function(_18){_16=map.getLayer(_18);if(!_16._suspended){_16._resized=true;}});}},_cleanUp:function(){_2.forEach(this._connects,_2.disconnect,_2);this._map=this._surface=null;},_processEvent:function(evt){var map=this._map;evt.screenPoint=new esri.geometry.Point(evt.pageX-map.position.x,evt.pageY-map.position.y);evt.mapPoint=map.toMap(evt.screenPoint);},_canvasDownHandler:function(evt){this._processEvent(evt);this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;},_canvasUpHandler:function(evt){this._processEvent(evt);this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;},_tolerance:15,_canvasClickHandler:function(evt){if(!this._downPt||!this._upPt||this._downPt!==this._upPt){return;}this._processEvent(evt);var map=this._map;var _19=_2.map(map.graphicsLayerIds,function(id){return map.getLayer(id);});_19.push(map.graphics);_19.reverse();_19=_2.filter(_19,function(_1a){return _1a.loaded&&_1a._mouseEvents&&_1a.visible&&(!esri._isDefined(_1a.opacity)||_1a.opacity>0);});var _1b=evt.screenPoint,geo=esri.geometry,_1c=this._tolerance;var _1d=_1b.x-_1c,_1e=_1b.y+_1c;var _1f=_1b.x+_1c,_20=_1b.y-_1c;var _21=new geo.Extent(_1d,_20,_1f,_1e);var _22=map.toMap(new geo.Point(_1d,_1e));var _23=map.toMap(new geo.Point(_1f,_20));var _24=new geo.Extent(_22.x,_22.y,_23.x,_23.y);var _25,_26=esri.isTouchEnabled;_2.some(_19,function(_27){var _28=_2.filter(_27.graphics,function(_29){var _2a=_29.getDojoShape();if(!_29.visible||!_2a){return false;}var _2b=_2a.getTransformedBoundingBox();if(_2b){var _2c=new geo.Extent(_2b[0].x,_2b[0].y,_2b[2].x,_2b[2].y);return _26?_2c.intersects(_21):_2c.contains(_1b);}else{return _2.some(_2a.children||[],function(_2d){_2b=_2d.getTransformedBoundingBox();var _2e=new geo.Extent(_2b[0].x,_2b[0].y,_2b[2].x,_2b[2].y);return _26?_2e.intersects(_21):_2e.contains(_1b);});}});if(_28.length>0){var _2f;_2.some(_28,function(_30){if(_30.geometry&&_24.intersects(_30.geometry)){_2f=_30;return true;}return false;});if(_2f){_25=_2f;return true;}}return false;});if(_25){var _31=_25.getLayer();if(_31){evt.graphic=_25;_31.onClick(evt);}}}});_2.declare("esri.layers._GraphicsLayer",esri.layers.Layer,{constructor:function(_32){if(_32&&(_2.isString(_32)||(_2.isObject(_32)&&_32.layerDefinition))){_32=arguments[1];}this._params=_2.mixin({displayOnPan:true,drawMode:true},_32||{});this.infoTemplate=_32&&_32.infoTemplate;this.graphics=[];this._init=false;this._suspended=false;this._draw=_2.hitch(this,this._draw);this._refresh=_2.hitch(this,this._refresh);},setDrawMode:function(_33){this._params.drawMode=_33;},renderer:null,_setMap:function(map,_34){this._map=map;var _35=map.spatialReference;this._wrap=map.wrapAround180;this._srInfo=_35._getInfo();if(!this._canvas){this._div=_34.createGroup();}else{_34=_3.gfx.createSurface(_34.getEventSource(),map.width,map.height);_2.style(_34.rawNode,"position","absolute");this._div=_34.createGroup();this._div.getEventSource=function(){return _34.rawNode;};this._renderProto=this._div.constructor.prototype._render;this._div._render=_2.hitch(this,this._canvasRender);}this._div.getEventSource().id=this.id+"_layer";this._enableAllConnectors();this._updateStatus();if(!this._suspended&&map.extent&&map.loaded===true){this._onExtentChangeHandler(map.extent,null,null,null);}var op=this.opacity;if(esri._isDefined(op)&&op<1){this.setOpacity(op,true);}return this._div;},_unsetMap:function(map,_36){_2.forEach(this.graphics,function(g){g._shape=null;});if(!this._canvas){this._div.clear();_36.remove(this._div);_2.destroy(this._div.getEventSource());}else{_36=this._div.getParent();_36._parent={};_2.destroy(_36.rawNode);_36.destroy();}this._map=this._div=null;this._init=false;this._disableAllConnectors();},_onZoomStartHandler:function(){esri.hide(this._div.getEventSource());},_onExtentChangeHandler:function(_37,_38,_39,lod){if(_39||!this._init){var _3a=this._map.__visibleRect,_3b=this._div;this._init=true;this._refresh(true);_3b.setTransform(_3.gfx.matrix.translate({x:_3a.x,y:_3a.y}));if(this._renderProto&&_3b.surface.pendingRender){this._dirty=true;}else{if(this.visible){esri.show(_3b.getEventSource());}}}else{if(this._resized){this._refresh(false);this._resized=false;}}if(this.graphics.length>0){this.onUpdate();}},_canvasRender:function(){var _3c=this._div;if(this._dirty){delete this._dirty;if(this.visible){esri.show(_3c.getEventSource());}}return this._renderProto.apply(_3c,arguments);},_refresh:function(_3d){var gs=this.graphics,il=gs.length,i,_3e=this._draw;for(i=0;i<il;i++){_3e(gs[i],_3d);}},refresh:function(){this._refresh(true);},_onPanHandler:function(_3f,_40){this._panDx=_40.x;this._panDy=_40.y;var _41=this._map.__visibleRect;this._div.setTransform(_3.gfx.matrix.translate({x:_41.x+_40.x,y:_41.y+_40.y}));},_onPanEndUpdateHandler:function(_42,_43){if(!this._params._child&&(_43.x!==this._panDx||_43.y!==this._panDy)){var _44=this._map.__visibleRect;this._div.setTransform(_3.gfx.matrix.translate({x:_44.x,y:_44.y}));}this._refresh(false);if(this.graphics.length){this.onUpdate();}},_onPanStartHandler:function(){esri.hide(this._div.getEventSource());},_onPanEndHandler:function(){var _45=this._map.__visibleRect,_46=this._div;_46.setTransform(_3.gfx.matrix.translate({x:_45.x,y:_45.y}));this._refresh(false);if(this._renderProto&&_46.surface.pendingRender){this._dirty=true;}else{esri.show(_46.getEventSource());}if(this.graphics.length){this.onUpdate();}},_getDesiredStatus:function(){return this.visible;},_updateStatus:function(){if(this._getDesiredStatus()){if(this._suspended){this._resume();}}else{if(!this._suspended){this._suspend();}}},_suspend:function(){this._suspended=true;esri.hide(this._div.getEventSource());this._disableDrawConnectors();},_resume:function(){var _47=this._div;this._suspended=false;this._enableDrawConnectors();var _48=this._map.__visibleRect;_47.setTransform(_3.gfx.matrix.translate({x:_48.x,y:_48.y}));this._refresh(true);if(this._renderProto&&_47.surface.pendingRender){this._dirty=true;}else{esri.show(_47.getEventSource());}},_enableAllConnectors:function(){this._disableAllConnectors();this._onVisibilityChangeHandler_connect=_2.connect(this,"onVisibilityChange",this,this._updateStatus);this._enableDrawConnectors();},_disableAllConnectors:function(){this._disableDrawConnectors();_2.disconnect(this._onVisibilityChangeHandler_connect);this._onVisibilityChangeHandler_connect=null;},_enableDrawConnectors:function(){var map=this._map,dc=_2.connect;this._disableDrawConnectors();if(this._params.displayOnPan){if(!this._params._child){this._onPanHandler_connect=dc(map,"onPan",this,"_onPanHandler");}this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndUpdateHandler");}else{this._onPanStartHandler_connect=dc(map,"onPanStart",this,"_onPanStartHandler");this._onPanEndHandler_connect=dc(map,"onPanEnd",this,"_onPanEndHandler");}this._onZoomStartHandler_connect=dc(map,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=dc(map,"onExtentChange",this,"_onExtentChangeHandler");},_disableDrawConnectors:function(){var dd=_2.disconnect;dd(this._onExtentChangeHandler_connect);dd(this._onZoomStartHandler_connect);dd(this._onPanHandler_connect);dd(this._onPanStartHandler_connect);dd(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null;},_updateExtent:function(_49){var _4a=_49.geometry,eg=esri.geometry;if(!_4a){_49._extent=null;return;}var _4b=(_49._extent=_4a.getExtent());if(!_4b){var x,y;if(_4a instanceof eg.Point){x=_4a.x;y=_4a.y;}else{if(_4a instanceof eg.Multipoint){x=_4a.points[0][0];y=_4a.points[0][1];}else{_49._extent=null;return;}}_49._extent=new eg.Extent(x,y,x,y,_4a.spatialReference);}},_intersects:function(map,_4c,_4d){if(this._wrap&&!_4d){var _4e=[],_4f=map._getFrameWidth(),_50=this._srInfo,_51,_52=map._clip?map._getAvailExtent():map.extent,_53=_52._getParts(_50),g,m,f,gl,ml,fl,_54,_55,_56=[],_57=_4c._partwise;if(_57&&_57.length){_51=[];for(g=0,gl=_57.length;g<gl;g++){_51=_51.concat(_57[g]._getParts(_50));}}else{_51=_4c._getParts(_50);}for(g=0,gl=_51.length;g<gl;g++){_54=_51[g];for(m=0,ml=_53.length;m<ml;m++){_55=_53[m];if(_55.extent.intersects(_54.extent)){for(f=0,fl=_54.frameIds.length;f<fl;f++){_4e.push((_55.frameIds[0]-_54.frameIds[f])*_4f);}}}}for(g=0,gl=_4e.length;g<gl;g++){f=_4e[g];if(_2.indexOf(_4e,f)===g){_56.push(f);}}return (_56.length)?_56:null;}else{return map.extent.intersects(_4c)?[0]:null;}},_draw:function(_58,_59){if(!this._params.drawMode||!this._map){return;}try{var _5a=_58._extent,_5b;if(_58.visible&&_5a&&(_5b=this._intersects(this._map,_5a,_58.geometry._originOnly))){if(!_58.getDojoShape()||_59||_5b){var _5c=_58.geometry.type;if(_5c==="point"){this._drawMarker(_58,_5b);this._symbolizeMarker(_58);}else{if(_5c==="multipoint"){this._drawMarkers(_58,_5b);this._symbolizeMarkers(_58);}else{this._drawShape(_58,_5b);this._symbolizeShape(_58);}}}}else{if(_58.getDojoShape()){this._removeShape(_58);}}}catch(err){this._errorHandler(err,_58);}},_removeShape:function(_5d){var _5e=_5d.getDojoShape();_5e.removeShape();_5d._shape=null;},_drawShape:function(_5f,_60){var _61=_5f.geometry,_62=_61.type,map=this._map,me=map.extent,mw=map.width,mh=map.height,eg=esri.geometry,_63=map.__visibleRect,_64=[],i,il;if(_62==="rect"||_62==="extent"){var _65;if(_62==="extent"){_65=eg.toScreenGeometry(me,mw,mh,_61);_65={x:_65.xmin-_63.x+_60[0],y:_65.ymax-_63.y,width:_65.getWidth(),height:_65.getHeight()};}else{var xy=eg.toScreenPoint(me,mw,mh,_61),wh=eg.toScreenPoint(me,mw,mh,{x:_61.x+_61.width,y:_61.y+_61.height});_65={x:xy.x-_63.x+_60[0],y:xy.y-_63.y,width:wh.x-xy.x,height:xy.y-wh.y};}if(_65.width===0){_65.width=1;}if(_65.height===0){_65.height=1;}_5f._shape=this._drawRect(this._div,_5f.getDojoShape(),_65);}else{if(_62==="polyline"||_62==="polygon"){for(i=0,il=_60.length;i<il;i++){_64=_64.concat(eg._toScreenPath(me,mw,mh,_61,-_63.x+_60[i],-_63.y));}_5f._shape=this._drawPath(this._div,_5f.getDojoShape(),_64);if(this._rendererLimits){if(_62==="polyline"){this._clipPolyline(_5f._shape,_61);}else{this._clipPolygon(_5f._shape,_61);}}}}},_drawRect:function(_66,_67,_68){return _67?_67.setShape(_68):_66.createRect(_68);},_drawImage:function(_69,_6a,_6b){return _6a?_6a.setShape(_6b):_69.createImage(_6b);},_drawCircle:function(_6c,_6d,_6e){return _6d?_6d.setShape(_6e):_6c.createCircle(_6e);},_drawPath:(function(){if(esri.vml){return function(_6f,_70,_71){if(_70){return _70.setShape(_71.join(" "));}else{var p=_6f.createObject(esri.gfx.Path,_71.join(" "));_6f._overrideSize(p.getEventSource());return p;}};}else{return function(_72,_73,_74){return _73?_73.setShape(_74.join(" ")):_72.createPath(_74.join(" "));};}}()),_drawText:function(_75,_76,_77){return _76?_76.setShape(_77):_75.createText(_77);},_getSymbol:function(_78){return _78.symbol||(this.renderer?this.renderer.getSymbol(_78):null)||null;},_symbolizeShape:function(_79){var _7a=this._getSymbol(_79);var _7b=_7a._stroke,_7c=_7a._fill;if(_7b===null||_7c===null){_7b=_7a.getStroke();_7c=_7a.getFill();}_79.getDojoShape().setStroke(_7b).setFill(_7c);_7a._stroke=_7b;_7a._fill=_7c;},_smsToPath:(function(){if(esri.vml){return function(SMS,_7d,x,y,xMh,xPh,yMh,yPh,_7e){switch(_7d){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"X","E"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,"L",x+","+yPh,"M",xMh+","+y,"L",xPh+","+y,"E"];case SMS.STYLE_X:return ["M",xMh+","+yMh,"L",xPh+","+yPh,"M",xMh+","+yPh,"L",xPh+","+yMh,"E"];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,"L",xPh+","+y,x+","+yPh,xMh+","+y,"X","E"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,"L",xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_7e)+","+y,"L",xMh+","+y,"M",x+","+(yMh-_7e),"L",x+","+yMh,"M",(xPh+_7e)+","+y,"L",xPh+","+y,"M",x+","+(yPh+_7e),"L",x+","+yPh,"E"];}};}else{return function(SMS,_7f,x,y,xMh,xPh,yMh,yPh,_80){switch(_7f){case SMS.STYLE_SQUARE:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,"Z"];case SMS.STYLE_CROSS:return ["M",x+","+yMh,x+","+yPh,"M",xMh+","+y,xPh+","+y];case SMS.STYLE_X:return ["M",xMh+","+yMh,xPh+","+yPh,"M",xMh+","+yPh,xPh+","+yMh];case SMS.STYLE_DIAMOND:return ["M",x+","+yMh,xPh+","+y,x+","+yPh,xMh+","+y,"Z"];case SMS.STYLE_TARGET:return ["M",xMh+","+yMh,xPh+","+yMh,xPh+","+yPh,xMh+","+yPh,xMh+","+yMh,"M",(xMh-_80)+","+y,xMh+","+y,"M",x+","+(yMh-_80),x+","+yMh,"M",(xPh+_80)+","+y,xPh+","+y,"M",x+","+(yPh+_80),x+","+yPh];}};}}()),_pathStyles:{"square":1,"cross":1,"x":1,"diamond":1,"target":1},_typeMaps:{"picturemarkersymbol":"image","textsymbol":"text"},_isInvalidShape:function(_81,_82){var _83=_82&&_82.shape&&_82.shape.type,_84=_81&&_81.type,_85=_81&&_81.style;if(!_85){if(_84){_85=this._typeMaps[_84];}}else{if(this._pathStyles[_85]){_85="path";}}if(_83&&_85&&(_83!==_85)){return true;}},_drawPoint:function(_86,_87,_88,_89,_8a){var _8b=_88.type,map=this._map,_8c=map.__visibleRect,_8d=esri.geometry.toScreenPoint(map.extent,map.width,map.height,_87).offset(-_8c.x+_8a[0],-_8c.y),px=_8d.x,py=_8d.y,_8e;if(this._isInvalidShape(_88,_89)){_89.removeShape();_89=null;}if(_8b==="simplemarkersymbol"){var _8f=_88.style,_90=_88.size/2,_91=Math.round,SMS=esri.symbol.SimpleMarkerSymbol;switch(_8f){case SMS.STYLE_SQUARE:case SMS.STYLE_CROSS:case SMS.STYLE_X:case SMS.STYLE_DIAMOND:_8e=this._drawPath(_86,_89,this._smsToPath(SMS,_8f,px,py,_91(px-_90),_91(px+_90),_91(py-_90),_91(py+_90)));break;case SMS.STYLE_TARGET:var _92=_88._targetWidth/2,_93=_88._targetHeight/2;_8e=this._drawPath(_86,_89,this._smsToPath(SMS,_8f,px,py,_91(px-_92),_91(px+_92),_91(py-_93),_91(py+_93),_88._spikeSize));break;default:_8e=this._drawCircle(_86,_89,{cx:px,cy:py,r:_90});}}else{if(_8b==="picturemarkersymbol"){var w=_88.width,h=_88.height;_8e=this._drawImage(_86,_89,{x:px-(w/2),y:py-(h/2),width:w,height:h,src:_88.url});}else{if(_8b==="textsymbol"){_8e=this._drawText(_86,_89,{type:"text",text:_88.text,x:px,y:py,align:_88.align,decoration:_88.decoration,rotated:_88.rotated,kerning:_88.kerning});}}}_8e.setTransform(_3.gfx.matrix.multiply(_3.gfx.matrix.translate(_88.xoffset,-_88.yoffset),_3.gfx.matrix.rotategAt(_88.angle,_8d)));_8e._wrapOffsets=_8a;return _8e;},_symbolizePoint:function(_94,_95){var _96=_95.type;if(_96==="picturemarkersymbol"){return;}var _97=_95._stroke,_98=_95._fill;if(_96==="textsymbol"){_94.setFont(_95.font).setFill(_95.getFill());}else{if(_97===null||_98===null){_97=_95.getStroke();_98=_95.getFill();}if(_96==="simplemarkersymbol"){_94.setFill(_98).setStroke(_97);}_95._stroke=_97;_95._fill=_98;}},_drawMarker:function(_99,_9a){_99._shape=this._drawPoint(this._div,_99.geometry,this._getSymbol(_99),_99.getDojoShape(),_9a);},_symbolizeMarker:function(_9b){this._symbolizePoint(_9b.getDojoShape(),this._getSymbol(_9b));},_drawMarkers:function(_9c,_9d){var _9e=_9c.geometry,_9f=_9e.points,_a0=this._getSymbol(_9c),_a1=_9c.getDojoShape()||this._div.createGroup(),_a2,i,il=_9f.length,_a3=[],idx=0,j,jl=_9d?_9d.length:0;if(_a1.children[0]&&this._isInvalidShape(_a0,_a1.children[0])){_a1.clear();}for(i=0;i<il;i++){_a2=_9f[i];for(j=0;j<jl;j++){_a3[0]=_9d[j];this._drawPoint(_a1,{x:_a2[0],y:_a2[1]},_a0,_a1.children[idx++],_a3);}}var _a4=_a1.children.length;if(il*_9d.length<_a4){for(i=_a4-1;i>=il*_9d.length;i--){_a1.children[i].removeShape();}}_9c._shape=_a1;},_symbolizeMarkers:function(_a5){var _a6=this._getSymbol(_a5),_a7=_a5.getDojoShape(),_a8=_a7.children,i,il=_a8.length;for(i=0;i<il;i++){this._symbolizePoint(_a8[i],_a6);}},_errorHandler:function(err,_a9){var msg=esri.bundle.layers.graphics.drawingError;if(_a9){err.message=msg+"(geometry:"+(_a9.geometry?_a9.geometry.declaredClass:null)+", symbol:"+(_a9.symbol?_a9.symbol.declaredClass:null)+"): "+err.message;}else{err.message=msg+"(null): "+err.message;}this.inherited(arguments);},_rendererLimits:(function(){var _aa,_ab,_ac;if(_2.isFF){_aa=16125;_ab=-32250;_ac=32250;}else{if(_2.isIE<9){_aa=100000;_ab=-100000;_ac=100000;}else{if(_2.isChrome&&_2.isChrome<6){_aa=8150;_ab=-10000;_ac=10000;}}}if(_aa){var _ad,_ae;_ad=[-_aa,-_aa,_aa,_aa];_ae=[[[-_aa,-_aa],[_aa,-_aa]],[[_aa,-_aa],[_aa,_aa]],[[_aa,_aa],[-_aa,_aa]],[[-_aa,_aa],[-_aa,-_aa]]];return {clipLimit:_aa,rangeMin:_ab,rangeMax:_ac,clipBBox:_ad,clipSegments:_ae};}}()),_clipPolyline:function(_af,_b0){var _b1=this._getCorners(_af,_b0);var _b2=_b1.tl,_b3=_b1.br;var _b4=this._rendererLimits;var _b5=_b4.rangeMin,_b6=_b4.rangeMax,_b7=_b4.clipBBox,_b8=_b4.clipSegments;var _b9=this._isPointWithinRange,_ba=this._isPointWithinBBox,_bb=this._getClipperIntersection,_bc=this._getPlaneIndex;if(!_b9(_b2,_b5,_b6)||!_b9(_b3,_b5,_b6)){if(esri.vml){this._createSegments(_af);}var _bd=[];_2.forEach(_af.segments,function(_be){var _bf=_be.args,len=_bf.length,_c0=[],i;for(i=0;i<len;i+=2){var pt1=[_bf[i],_bf[i+1]];var pt2=[_bf[i+2],_bf[i+3]];var _c1=_ba(pt1,_b7);var _c2=_ba(pt2,_b7);if(_c1^_c2){var _c3=_bb([pt1,pt2],_b8);if(_c3){if(!_c1){_c0.push(_c3[1],pt2);}else{if(i){_c0.push(_c3[1]);}else{_c0.push(pt1,_c3[1]);}_bd.push(_c0);_c0=[];}}}else{if(_c1){if(i){_c0.push(pt2);}else{_c0.push(pt1,pt2);}}else{var _c4=_bc(pt1,_b7);var _c5=_bc(pt2,_b7);if(_c4===-1||_c5===-1||_c4===_c5){continue;}var _c6=_bb([pt1,pt2],_b8,true);if(_c6.length>0){if(!_c6[_c4]){_c4=_c6[_c4[0]]?_c4[0]:_c4[1];}if(!_c6[_c5]){_c5=_c6[_c5[0]]?_c5[0]:_c5[1];}var _c7=_c6[_c4],_c8=_c6[_c5];if(_c7){_c0.push(_c7);}if(_c8){_c0.push(_c8);_bd.push(_c0);_c0=[];}}}}}_bd.push(_c0);});_af.setShape(this._getPathStringFromPaths(_bd));}},_clipPolygon:function(_c9,_ca){var _cb=this._getCorners(_c9,_ca);var _cc=_cb.tl,_cd=_cb.br;var _ce=this._rendererLimits;var _cf=_ce.clipLimit,_d0=_ce.rangeMin,_d1=_ce.rangeMax,_d2=_ce.clipBBox,_d3=_ce.clipSegments;var _d4=this._isPointWithinRange,_d5=this._isPointWithinBBox,_d6=this._getClipperIntersection,_d7=this._getPlaneIndex,_d8=esri.geometry._pointLineDistance;if(!_d4(_cc,_d0,_d1)||!_d4(_cd,_d0,_d1)){if(esri.vml){this._createSegments(_c9);}var _d9=_2.map(_c9.segments,function(_da){var _db=_da.args,len=_db.length,_dc=[],_dd=[],i;for(i=0;i<len;i+=2){var pt1=[_db[i],_db[i+1]];var pt2=[_db[i+2],_db[i+3]];if(i===(len-2)){_dc.push(pt1);break;}var _de=_d5(pt1,_d2);var _df=_d5(pt2,_d2);_dc.push(pt1);if(_de^_df){var _e0=_d6([pt1,pt2],_d3);if(_e0){var _e1=_e0[1];_e1[_de?"inOut":"outIn"]=true;_dc.push(_e1);_dd.push([_de?"INOUT":"OUTIN",_dc.length-1,_e0[0]]);}}else{if(!_de){var _e2=_d7(pt1,_d2);var _e3=_d7(pt2,_d2);if(_e2===-1||_e3===-1||_e2===_e3){continue;}var _e0=_d6([pt1,pt2],_d3,true);if(_e0.length>0){if(!_e0[_e2]){_e2=_e0[_e2[0]]?_e2[0]:_e2[1];}if(!_e0[_e3]){_e3=_e0[_e3[0]]?_e3[0]:_e3[1];}var _e4=_e0[_e2],_e5=_e0[_e3];if(_e4){_e4.outIn=true;_dc.push(_e4);_dd.push(["OUTIN",_dc.length-1,_e2]);}if(_e5){_e5.inOut=true;_dc.push(_e5);_dd.push(["INOUT",_dc.length-1,_e3]);}}else{if(_2.isArray(_e2)&&_2.isArray(_e3)){var _e6=_e2.concat(_e3);_e6.sort();if(_e6.join("")==="0123"){var _e7=[];if((_e2[0]+_e2[1])===3){_e7.push([_cf,-_cf],[-_cf,_cf]);}else{_e7.push([-_cf,-_cf],[_cf,_cf]);}var d1=_d8(_e7[0],[pt1,pt2]);var d2=_d8(_e7[1],[pt1,pt2]);_dc.push((d1<d2)?_e7[0]:_e7[1]);}}}}}}var _e8=_d2[0],_e9=_d2[1],_ea=_d2[2],_eb=_d2[3];_2.forEach(_dc,function(_ec){if(_ec[0]<_e8){if(_ec[1]>=_e9&&_ec[1]<=_eb){_ec[0]=_e8;}else{_ec[0]=_e8;_ec[1]=_ec[1]<_e9?_e9:_eb;}}});_2.forEach(_dc,function(_ed){if(_ed[1]<_e9){if(_ed[0]>=_e8&&_ed[0]<=_ea){_ed[1]=_e9;}else{_ed[1]=_e9;_ed[0]=_ed[0]<_e8?_e8:_ea;}}});_2.forEach(_dc,function(_ee){if(_ee[0]>_ea){if(_ee[1]>=_e9&&_ee[1]<=_eb){_ee[0]=_ea;}else{_ee[0]=_ea;_ee[1]=_ee[1]<_e9?_e9:_eb;}}});_2.forEach(_dc,function(_ef){if(_ef[1]>_eb){if(_ef[0]>=_e8&&_ef[0]<=_ea){_ef[1]=_eb;}else{_ef[1]=_eb;_ef[0]=_ef[0]<_e8?_e8:_ea;}}});var k=0,len=_dd.length;if(len>0){do{var _f0=_dd[k];var _f1=_dd[(k+1)%len];if(_f0[2]===_f1[2]&&_f0[0]==="INOUT"&&_f1[0]==="OUTIN"){var _f2=_f0[1],end=_f1[1],u;if(_f2<end){for(u=_f2+1;u<end;u++){_dc[u][2]=true;}}else{if(_f2>end){for(u=_f2+1;u<_dc.length;u++){_dc[u][2]=true;}for(u=0;u<end;u++){_dc[u][2]=true;}}}}k=(k+1)%len;}while(k!==0);}var _f3=_dc[0],_f4=_dc[_dc.length-1];if(_f3[2]){_f4[2]=true;_2.some(_dd,function(_f5){if(_f5[1]===1){_dc.splice(_dc.length-1,0,_2.clone(_dc[1]));return true;}return false;});}_dc=_2.filter(_dc,function(_f6){return _f6[2]?false:true;});for(k=0;k<_dc.length-1;k++){var now=_dc[k];var _f1=_dc[k+1];if(!_f1||(now[0]!==_f1[0])||(now[1]!==_f1[1])){continue;}if(_f1.outIn){now.outIn=true;}else{if(_f1.inOut){now.inOut=true;}}_dc.splice(k+1,1);}var abs=Math.abs,_f7=[];for(k=0;k<_dc.length-1;k++){var _f0=_dc[k],cx=_f0[0],cy=_f0[1];var x1=(abs(cx)===_cf);var y1=(abs(cy)===_cf);var _f1=_dc[k+1],nx=_f1[0],ny=_f1[1];var x2=(abs(nx)===_cf);var y2=(abs(ny)===_cf);if(x1&&y2){_f7.push([k+1,[cx,ny]]);}else{if(y1&&x2){_f7.push([k+1,[nx,cy]]);}}}for(k=_f7.length-1;k>=0;k--){var _f8=_f7[k];var _f9=_dc[_f8[0]-1];var now=_dc[_f8[0]];if(_f9.outIn||_f9.inOut||now.outIn||now.inOut){continue;}_dc.splice(_f8[0],0,_f8[1]);}var _f3=_dc[0],_f4=_dc[_dc.length-1];if(_f3[0]!==_f4[0]||_f3[1]!==_f4[1]){_dc.push(_f3);}return _dc;});_c9.setShape(this._getPathStringFromPaths(_d9));}},_getCorners:function(_fa,_fb){if(esri.vml){var map=this._map;var _fc=_fb.getExtent();var _fd=map.toScreen(new esri.geometry.Point(_fc.xmin,_fc.ymax));var _fe=map.toScreen(new esri.geometry.Point(_fc.xmax,_fc.ymin));return {tl:_fd,br:_fe};}else{var _ff=_fa.getTransformedBoundingBox();return {tl:_ff[0],br:_ff[2]};}},_createSegments:function(_100){_100.shape.path=_100.vmlPath;_100.segmented=false;_100._confirmSegmented();var _101=_100.segments;if(_101.length>1){_100.segments=_2.filter(_101,function(_102,idx,arr){var next=arr[idx+1];if(_102.action==="M"&&next&&next.action==="L"){_102.args=_102.args.concat(next.args);return true;}return false;});}},_getPathStringFromPaths:function(_103){if(esri.vml){_103=_2.map(_103,function(path){var _104=_2.map(path,function(_105,idx){return (idx===1?"l ":"")+_105.join(",");});return "m "+_104.join(" ");});_103.push("e");}else{_103=_2.map(_103,function(path){var _106=_2.map(path,function(_107){return _107.join(",");});return "M "+_106.join(" ");});}return _103.join(" ");},_isPointWithinBBox:function(_108,bbox){var left=bbox[0],top=bbox[1];var _109=bbox[2],_10a=bbox[3];var x=_108[0],y=_108[1];if(x>left&&x<_109&&y>top&&y<_10a){return true;}else{return false;}},_isPointWithinRange:function(_10b,_10c,_10d){var x=_10b.x,y=_10b.y;if(x<_10c||y<_10c||x>_10d||y>_10d){return false;}else{return true;}},_getClipperIntersection:function(line,_10e,_10f){var i,_110=esri.geometry._getLineIntersection2,_111=Math.round,data={length:0};for(i=0;i<4;i++){var _112=_110(line,_10e[i]);if(_112){_112[0]=_111(_112[0]);_112[1]=_111(_112[1]);if(!_10f){return [i,_112];}else{data[i]=_112;data.length++;}}}return _10f?data:null;},_getPlaneIndex:function(_113,_114){var px=_113[0],py=_113[1],xmin=_114[0],ymin=_114[1],xmax=_114[2],ymax=_114[3];if(px<=xmin){if((py>=ymin)&&(py<=ymax)){return 3;}else{return (py<ymin)?[0,3]:[2,3];}}if(py<=ymin){if((px>=xmin)&&(px<=xmax)){return 0;}else{return (px<xmin)?[3,0]:[1,0];}}if(px>=xmax){if((py>=ymin)&&(py<=ymax)){return 1;}else{return (py<ymin)?[0,1]:[2,1];}}if(py>=ymax){if((px>=xmin)&&(px<=xmax)){return 2;}else{return (px<xmin)?[3,2]:[1,2];}}return -1;},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicsClear:function(){},onOpacityChange:function(){},setInfoTemplate:function(_115){this.infoTemplate=_115;},add:function(_116){var _117=arguments[1];if(_116._graphicsLayer===this){return _116;}if(!_117){this.graphics.push(_116);}_116._graphicsLayer=this;this._updateExtent(_116);this._draw(_116);if(!_117){this.onGraphicAdd(_116);}return _116;},remove:function(_118){if(!arguments[1]){var _119=this.graphics,i;if((i=_2.indexOf(_119,_118))===-1){return null;}_118=this.graphics.splice(i,1)[0];}if(_118.getDojoShape()){this._removeShape(_118);}_118._shape=_118._graphicsLayer=null;this.onGraphicRemove(_118);return _118;},clear:function(){var _11a=arguments[1],g=this.graphics;while(g.length>0){this.remove(g[0]);}if(!_11a){this.onGraphicsClear();}},setOpacity:function(op,_11b){if(_11b||this.opacity!=op){var div=this._div;if(div){if(esri.vml){_2.forEach(this.graphics,function(_11c){var _11d=_11c._shape;var node=_11d&&_11d.getNode();if(node){var _11e=_11d.strokeStyle,_11f=node.stroke;if(_11e&&_11f){_11f.opacity=_11e.color.a*op;}var _120=_11d.fillStyle,fill=node.fill;if(_120&&fill){if(fill.type==="tile"){_2.style(node,"opacity",op);}else{fill.opacity=_120.a*op;}}}});div._esriIeOpacity=op;}else{if(this._canvas){_2.style(div.getEventSource(),"opacity",op);}else{div.getEventSource().setAttribute("opacity",op);}}}this.opacity=op;if(!_11b){this.onOpacityChange(op);}}},setRenderer:function(ren){this.renderer=ren;}});_2.declare("esri.layers.GraphicsLayer",esri.layers._GraphicsLayer,{constructor:function(){this.enableMouseEvents=_2.hitch(this,this.enableMouseEvents);this.disableMouseEvents=_2.hitch(this,this.disableMouseEvents);this._processEvent=_2.hitch(this,this._processEvent);this._initLayer();},_initLayer:function(){this.loaded=true;this.onLoad(this);},_setMap:function(){var d=this.inherited("_setMap",arguments);this.enableMouseEvents();return d;},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",arguments);},_processEvent:function(evt){var _121=this._map,g=this.graphics,gl=g.length;evt.screenPoint=new esri.geometry.Point(evt.pageX-_121.position.x,evt.pageY-_121.position.y);evt.mapPoint=_121.toMap(evt.screenPoint);var i,es,gr,ds,_122=evt.target,_123=_122.parentNode;for(i=0;i<gl;i++){gr=g[i];ds=gr.getDojoShape();if(ds){es=ds.getEventSource();if(es===_122||es===_123){evt.graphic=gr;return evt;}}}},_onMouseOverHandler:function(evt){if(this._processEvent(evt)){this.onMouseOver(evt);}},_onMouseMoveHandler:function(evt){if(this._processEvent(evt)){this.onMouseMove(evt);}},_onMouseDragHandler:function(evt){if(this._processEvent(evt)){this.onMouseDrag(evt);}},_onMouseOutHandler:function(evt){if(this._processEvent(evt)){this.onMouseOut(evt);}},_onMouseDownHandler:function(evt){this._downGr=this._downPt=null;if(this._processEvent(evt)){_2.disconnect(this._onmousemove_connect);_2.disconnect(this._onmousedrag_connect);this._onmousedrag_connect=_2.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler");this._downGr=evt.graphic;this._downPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseDown(evt);}},_onMouseUpHandler:function(evt){this._upGr=this._upPt=null;if(this._processEvent(evt)){_2.disconnect(this._onmousedrag_connect);_2.disconnect(this._onmousemove_connect);this._onmousemove_connect=_2.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler");this._upGr=evt.graphic;this._upPt=evt.screenPoint.x+","+evt.screenPoint.y;this.onMouseUp(evt);}},_onClickHandler:function(evt){if(this._processEvent(evt)){var _124=this._downGr,upGr=this._upGr;if(_124&&upGr&&_124===upGr&&this._downPt===this._upPt){if(_2.isIE<9){esri.layers.GraphicsLayer._clicked=evt.graphic;}this.onClick(evt);}}},_onDblClickHandler:function(evt){if(this._processEvent(evt)){this.onDblClick(evt);}},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(this._mouseEvents){return;}var dc=_2.connect,gc=this._div.getEventSource();if(_3.gfx.renderer!=="canvas"){this._onmouseover_connect=dc(gc,"onmouseover",this,"_onMouseOverHandler");this._onmousemove_connect=dc(gc,"onmousemove",this,"_onMouseMoveHandler");this._onmouseout_connect=dc(gc,"onmouseout",this,"_onMouseOutHandler");this._onmousedown_connect=dc(gc,"onmousedown",this,"_onMouseDownHandler");this._onmouseup_connect=dc(gc,"onmouseup",this,"_onMouseUpHandler");this._onclick_connect=dc(gc,"onclick",this,"_onClickHandler");this._ondblclick_connect=dc(gc,"ondblclick",this,"_onDblClickHandler");}this._mouseEvents=true;},disableMouseEvents:function(){if(!this._mouseEvents){return;}var ddc=_2.disconnect;ddc(this._onmouseover_connect);ddc(this._onmousemove_connect);ddc(this._onmousedrag_connect);ddc(this._onmouseout_connect);ddc(this._onmousedown_connect);ddc(this._onmouseup_connect);ddc(this._onclick_connect);ddc(this._ondblclick_connect);this._mouseEvents=false;}});});