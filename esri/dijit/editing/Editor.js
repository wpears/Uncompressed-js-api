/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!dijit/ProgressBar,dijit/_Widget,dijit/_Templated,esri/toolbars/edit,esri/toolbars/draw,esri/layers/FeatureLayer,esri/dijit/editing/Util,esri/dijit/editing/toolbars/Drawing,esri/dijit/editing/TemplatePicker,esri/dijit/AttributeInspector,esri/dijit/editing/SelectionHelper,esri/undoManager,esri/dijit/editing/editOperation"],function(_1,_2,_3){_2.provide("esri.dijit.editing.Editor");_2.require("dijit.ProgressBar");_2.require("dijit._Widget");_2.require("dijit._Templated");_2.require("esri.toolbars.edit");_2.require("esri.toolbars.draw");_2.require("esri.layers.FeatureLayer");_2.require("esri.dijit.editing.Util");_2.require("esri.dijit.editing.toolbars.Drawing");_2.require("esri.dijit.editing.TemplatePicker");_2.require("esri.dijit.AttributeInspector");_2.require("esri.dijit.editing.SelectionHelper");_2.require("esri.undoManager");_2.require("esri.dijit.editing.editOperation");(function(){var _4=[_2.moduleUrl("esri.dijit.editing","css/editor.css")];var _5=document.getElementsByTagName("head").item(0),_6;for(var i=0,il=_4.length;i<il;i++){_6=document.createElement("link");_6.type="text/css";_6.rel="stylesheet";_6.href=_4[i].toString();_5.appendChild(_6);}}());_2.declare("esri.dijit.editing.Editor",[_1._Widget,_1._Templated],{widgetsInTemplate:true,templateString:"<div class=\"esriEditor\">\r\n    <div class=\"esriTemplatePicker\" dojoAttachPoint=\"templatePickerDiv\"></div>\r\n    <div class=\"esriDrawingToolbar\" dojoAttachPoint=\"drawingToolbarDiv\"></div>\r\n    <div class=\"progressBar\" dojoAttachPoint=\"progressBar\" indeterminate=\"true\" dojoType=\"dijit.ProgressBar\" />\r\n</div>",constructor:function(_7,_8){_7=_7||{};if(!_7.settings){console.error("Editor: please provide 'settings' parameter in the constructor");}if(!_7.settings.layerInfos){console.error("Editor: please provide 'layerInfos' parameter in the constructor");}this._settings=_7.settings;this._eConnects=[];},postCreate:function(){this._setDefaultOptions();this._initLayers();this._connectEvents();this._createWidgets();this._reset();this._enableMapClickHandler();},stopEditing:function(_9){this._updateCurrentFeature(_2.hitch(this,function(){this._clearSelection(false);_9&&_9();}));},destroy:function(){if(this.drawingToolbar){this.drawingToolbar.destroy();}if(this.attributeInspector){this.attributeInspector.destroy();}if(this.templatePicker){this.templatePicker.destroy();}if(this._selectionHelper){this._selectionHelper.destroy();}if(this._drawToolbar){this._drawToolbar.deactivate();}this._reset();this._disableMapClickHandler();_2.forEach(this._eConnects,"dojo.disconnect(item);");_2.disconnect(this._dtConnect);_2.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this._editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;if(this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures){this._settings.map.infoWindow.clearFeatures();}this.inherited(arguments);},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new esri.toolbars.Draw(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this._editToolbar=this._settings.editToolbar||new esri.toolbars.Edit(this._settings.map);this._settings.editToolbar=this._editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||false;this._settings.toolbarOptions=_2.mixin({reshapeVisible:false,cutVisible:false,mergeVisible:false},this._settings.toolbarOptions);this._settings.createOptions=_2.mixin({polylineDrawTools:[esri.dijit.editing.Editor.CREATE_TOOL_POLYLINE],polygonDrawTools:[esri.dijit.editing.Editor.CREATE_TOOL_POLYGON],editAttributesImmediately:true},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?true:false;this._datePackage=this._settings.datePackage;var _a=esri.config.defaults;this._settings.geometryService=this._settings.geometryService||_a.geometryService;_a.geometryService=_a.geometryService||this._settings.geometryService;},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};var _b=this._settings.layerInfos;_2.forEach(_b,function(_c){if(_c.featureLayer&&_c.featureLayer.loaded){this._settings.layers.push(_c.featureLayer);var _d=_c.featureLayer.id;if(_c.featureLayer.credential){this._settings.userIds[_d]=_c.featureLayer.credential.userId;}if(_c.userId){this._settings.userIds[_d]=_c.userId;}var _e=_c.featureLayer.getEditCapabilities();if(_e.canCreate&&!_e.canUpdate){this._settings.createOnlyLayer[_d]=true;}else{this._settings.createOnlyLayer[_d]=false;}}},this);},_reset:function(){this._hideAttributeInspector();this._editToolbar.deactivate();this._editVertices=true;this._layer=null;this._currentGraphic=null;this._activeType=null;this._activeTemplate=null;this._drawingTool=null;this._attributeChanged=false;},_saveFeatureOnClient:function(_f){var _10=this.templatePicker.getSelected();var _11;if(_10.template){_11=_10.featureLayer.renderer.getSymbol(_10.template.prototype);}else{_11=_10.symbolInfo.symbol;}var _12=_10.featureLayer.fields;var att={};_2.forEach(_12,function(_13,idx){att[_13.name]=null;});this._tempGraphic=new esri.Graphic(_f,_11,att,null);var map=this._settings.map;map.graphics.add(this._tempGraphic);var _14=this._findCenterPoint(_f);this._createAttributeInspector(true);map.infoWindow.setTitle(_10.featureLayer?_10.featureLayer.name:esri.bundle.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,_10.featureLayer);map.infoWindow.show(_14,map.getInfoWindowAnchor(_14));if(this._settings.createOnlyLayer[_10.featureLayer.id]){this._infoWindowHideEvent=_2.connect(map.infoWindow,"onHide",this,"_infoWindowHide");}_2.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();if(this.drawingToolbar){this.drawingToolbar.deactivate();}this._templatePickerOnSelectionChangeEvent=_2.connect(this.templatePicker,"onSelectionChange",_2.hitch(this,"_onCreateFeature"));},_saveAttributesOnClient:function(_15,_16,_17){this._tempGraphic.attributes[_16]=(typeof (_17)==="number"&&isNaN(_17))?null:_17;},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);_2.disconnect(this._infoWindowHideEvent);},_createFeature:function(_18,_19){this._editClickPoint=this._findCenterPoint(_18);if(!_18.rings){this._applyEdits([{layer:this._layer,adds:[this._createGraphic(_18,_19)]}]);return;}this._simplify(_18,_2.hitch(this,function(_1a){if(this._drawingTool!==esri.layers.FeatureTemplate.TOOL_AUTO_COMPLETE_POLYGON){this._applyEdits([{layer:this._layer,adds:[this._createGraphic(_1a,_19)]}]);}else{this._autoComplete(_1a,_2.hitch(this,function(_1b){if(_1b&&_1b.length){this._applyEdits([{layer:this._layer,adds:_2.map(_1b,_2.hitch(this,function(_1c){return this._createGraphic(_1c,_19);}))}]);}}));}}));},_updateCurrentFeature:function(_1d){var _1e=this._isModified();if(_1e){this._updateFeature(_1e,_1d);}else{if(_1d){_1d(false);}}},_updateFeature:function(_1f,_20){var _21=_1f.geometry;if(!_21.rings){this._applyEdits([{layer:_1f.getLayer(),updates:[_1f]}],_20);}else{this._simplify(_21,_2.hitch(this,function(_22){this._applyEdits([{layer:_1f.getLayer(),updates:[_2.mixin(_1f,{geometry:_22})]}],_20);}));}},_deleteFeature:function(_23,_24){var _25=[];if(!_23){var _26=this._settings.layers;_25=_2.map(_2.filter(_26,function(_27){return _27.getSelectedFeatures().length>0;}),"return {layer:item, deletes: item.getSelectedFeatures()}");if((!_25||!_25.length)&&this._currentGraphic){_25.push({layer:this._layer,deletes:[this._currentGraphic]});}}else{_25.push({layer:_23.getLayer(),deletes:[_23]});}this._applyEdits(_25,(_24));},_stopEditing:function(_28,_29,_2a,_2b){esri.hide(this.progressBar.domNode);this._undoRedoAdd();var _2c;if(_28._isSelOnly===true){if(_29&&_29.length){this.templatePicker.clearSelection();var _2d=new esri.tasks.Query();_2d.objectIds=[_29[0].objectId];if(!this._settings.createOnlyLayer[_28.id]){this._selectFeatures([_28],_2d,_2.hitch(this,"_onEditFeature"));}else{this._settings.map.graphics.remove(this._tempGraphic);}}}else{_2c=this._selectionHelper.findMapService(this._settings.map,_28);if(_2c){_2c.refresh();}if(_29&&_29.length){this.templatePicker.clearSelection();if(!this._settings.createOnlyLayer[_28.id]){esri.dijit.editing.Util.LayerHelper.findFeatures(_29,_28,_2.hitch(this,"_onEditFeature"));}else{this._settings.map.graphics.remove(this._tempGraphic);}}}if(_2b&&_2b.length){this._clearSelection(true);if(this._undoRedo){_2c=this._selectionHelper.findMapService(_28,this._settings.map);if(_2c){_2c.refresh();}}}if(this._undoRedo&&_2a&&_2a.length){_2c=this._selectionHelper.findMapService(_28,this._settings.map);if(_2c){_2c.refresh();}this.attributeInspector.refresh();this._undoRedo=false;}if(this.drawingToolbar){this.drawingToolbar._updateUI();}this._undoRedo=false;},_undoRedoAdd:function(){this._settings._isApplyEditsCall=false;if(!this._settings.undoManager){return;}if(this._activeTool==="CUT"||this._activeTool==="UNION"){return;}var _2e=(this._edits&&this._edits.length)?this._edits[0]:null;if(!_2e){return;}var _2f=_2e.adds||[];var _30=_2e.updates||[];var _31=_2e.deletes||[];var _32={featureLayer:_2e.layer};if(_2f.length){this.undoManager.add(new esri.dijit.editing.Add(_2.mixin(_32,{addedGraphics:_2f})));}else{if(_31.length){this.undoManager.add(new esri.dijit.editing.Delete(_2.mixin(_32,{deletedGraphics:_31})));}else{if(_30.length){this.undoManager.add(new esri.dijit.editing.Update(_2.mixin(_32,{preUpdatedGraphics:[this._preUpdates],postUpdatedGraphics:_30})));}}}this._edits=null;this._preUpdates=null;},_activateDrawToolbar:function(_33){this._layer=_33.featureLayer;this._activeType=_33.type;this._activeTemplate=_33.template;this._drawingTool=this._activeTemplate?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,_33.featureLayer);_2.disconnect(this._dtConnect);if(this._settings.createOnlyLayer[_33.featureLayer.id]){this._dtConnect=_2.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient");}else{this._dtConnect=_2.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");}this._editToolbar.deactivate();this._disableMapClickHandler();if(!this.drawingToolbar){this._drawToolbar.activate(this._drawTool);}else{this.drawingToolbar.activateEditing(this._drawTool,this._layer);}},_activateEditToolbar:function(_34,_35){var _36=_34.getLayer();var _37=_36?_36.geometryType:null;var _38=esri.toolbars.Edit.MOVE;if(_37!=="esriGeometryPoint"&&this._isNotesFeature(_34)===true){_38=_38|esri.toolbars.Edit.ROTATE|esri.toolbars.Edit.SCALE;this._editVertices=false;}else{if(_37!=="esriGeometryPoint"&&this._editVertices===true){_38=_38|esri.toolbars.Edit.ROTATE|esri.toolbars.Edit.SCALE;this._editVertices=false;}else{_38=_38|esri.toolbars.Edit.EDIT_VERTICES;this._editVertices=true;}}this._attributeChanged=this._isModified();this._preUpdates=new esri.Graphic(_2.clone(_34.toJson()));var _39=_36.getEditCapabilities({feature:_34,userId:this._settings.userIds[_36.id]});var _3a=_2.filter(this._settings.layerInfos,function(_3b){return _3b.featureLayer["layerId"]===_36.layerId;})[0];if(_39.canUpdate&&!_3a.disableGeometryUpdate&&_36.allowGeometryUpdates){this._editToolbar.activate(_38,_34);}if(!this._settings.map.infoWindow.isShowing){var _3c=(_35&&_35.screenPoint)||this._findCenterPoint(_34);this._settings.map.infoWindow.show(_3c,this._settings.map.getInfoWindowAnchor(_3c));}},_createGraphic:function(_3d,_3e){var _3f=(this._activeType&&this._activeType.symbol)||this._layer.defaultSymbol;var _40=new esri.Graphic(_3d,_3f,_3e);if(this._activeTemplate||_3e){_40.attributes=_3e||_2.mixin({},this._activeTemplate.prototype.attributes);}else{_40.attributes=_40.attributes||[];_2.forEach(this._layer.fields,function(_41){_40.attributes[_41.name]=null;},this);}return _40;},_connectEvents:function(){var _42=this._settings.layers;_2.forEach(_42,"this._connect(item, 'onEditsComplete', dojo.hitch(this, '_stopEditing', item))",this);_2.forEach(_42,"this._connect(item, 'onBeforeApplyEdits', dojo.hitch(this, function() { esri.show(this.progressBar.domNode); this._settings._isApplyEditsCall = true;  }))",this);this._connect(this._editToolbar,"onGraphicClick",_2.hitch(this,"_activateEditToolbar"));this._connect(this._editToolbar,"onGraphicFirstMove",_2.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onVertexFirstMove",_2.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onScaleStart",_2.hitch(this,"_hideAttributeInspector"));this._connect(this._editToolbar,"onRotateStart",_2.hitch(this,"_hideAttributeInspector"));},_connect:function(_43,evt,_44){this._eConnects.push(_2.connect(_43,evt,_44));},_createWidgets:function(){this._selectionHelper=new esri.dijit.editing.SelectionHelper(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager();},_createTemplatePicker:function(){if(!this._settings.templatePicker){var _45=_2.filter(this._settings.layers,function(_46){return _46.getEditCapabilities().canCreate;});this.templatePicker=new esri.dijit.editing.TemplatePicker({"class":"esriTemplatePicker",featureLayers:_45,showTooltip:true,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker;}else{this.templatePicker=this._settings.templatePicker;esri.hide(this.templatePickerDiv);}this._templatePickerOnSelectionChangeEvent=_2.connect(this.templatePicker,"onSelectionChange",_2.hitch(this,"_onCreateFeature"));},_createAttributeInspector:function(_47){if(!this._settings.attributeInspector){this._customAttributeInspector=false;var map=this._settings.map;this.attributeInspector=new esri.dijit.AttributeInspector({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},_2.create("div"));this.attributeInspector.startup();map.infoWindow.setContent(this.attributeInspector.domNode);map.infoWindow.setTitle(esri.bundle.widgets.attributeInspector.NLS_title);map.infoWindow.resize(350,375);_2.query(".esriAttributeInspector .atiLayerName").style({display:"none"});}else{this._customAttributeInspector=true;this.attributeInspector=this._settings.attributeInspector;}this._connect(this.attributeInspector,"onDelete",_2.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",_2.hitch(this,function(_48){this._updateCurrentFeature(_2.hitch(this,function(){this._attributeChanged=false;this._onEditFeature(_48);}));}));if(this._usePopup){this._settings.map.infoWindow._setPagerCallbacks(this.attributeInspector,_2.hitch(this.attributeInspector,"next"),_2.hitch(this.attributeInspector,"previous"));}if(_47){this._connect(this.attributeInspector,"onAttributeChange",_2.hitch(this,"_saveAttributesOnClient"));}else{this._connect(this.attributeInspector,"onAttributeChange",_2.hitch(this,function(_49,_4a,_4b){this._preUpdates=new esri.Graphic(_2.clone(_49.toJson()));this._currentGraphic.attributes[_4a]=(typeof (_4b)==="number"&&isNaN(_4b))?null:_4b;this._updateFeature(this._currentGraphic,null);this._attributeChanged=false;}));}},_createDrawingToolbar:function(){if(this._settings.toolbarVisible===true){this.drawingToolbar=new esri.dijit.editing.toolbars.Drawing({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this._editToolbar,settings:this._settings,onDelete:_2.hitch(this,"_deleteFeature"),onApplyEdits:_2.hitch(this,"_applyEdits"),onShowAttributeInspector:_2.hitch(this,"_onEditFeature")},this.drawingToolbarDiv);}},_createUndoRedoManager:function(){if(!this._settings.enableUndoRedo&&!this._settings.undoManager){return;}this._settings.enableUndoRedo=true;this.undoManager=this._settings.undoManager;if(!this.undoManager){this.undoManager=this._settings.undoManager=new esri.UndoManager({maxOperations:this._settings.maxUndoRedoOperations});}this._connect(document,"onkeypress",_2.hitch(this,function(evt){if(evt.metaKey||evt.ctrlKey){if(evt.charOrCode==="z"){this._undo();}if(evt.charOrCode==="y"){this._redo();}}}));},_enableMapClickHandler:function(){this._mapClickHandler=_2.connect(this._settings.map,"onClick",_2.hitch(this,function(evt){if(this._drawToolbar._geometryType){return;}if(this._activeTool==="SELECT"){this._activeTool="";return;}this._updateCurrentFeature(_2.hitch(this,function(){this._reset();this._updateSelection(evt);}));}));},_disableMapClickHandler:function(){_2.disconnect(this._mapClickHandler);},_onCreateFeature:function(){var _4c=this.templatePicker.getSelected();if(_4c){this._updateCurrentFeature(_2.hitch(this,function(){if(this._currentGraphic){this._clearSelection(false);}this._reset();this._activateDrawToolbar(_4c);}));}else{this._reset();_2.disconnect(this._dtConnect);this._drawToolbar.deactivate();this._enableMapClickHandler();if(this.drawingToolbar){this.drawingToolbar.deactivate();}}},_onEditFeature:function(_4d,_4e){_4d=(_2.isArray(_4d)?_4d[0]:_4d)||null;if(!_4d){return;}if(!this._customAttributeInspector){_4e=_4e||this._editClickPoint||this._findCenterPoint(_4d);var _4f=_4d.getLayer();this._settings.map.infoWindow.setTitle(_4f?_4f.name:esri.bundle.widgets.attributeInspector.NLS_title);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing){this._settings.map.infoWindow.show(_4e,this._settings.map.getInfoWindowAnchor(_4e));}this._editClickPoint=null;}if(_4d===this._currentGraphic){return;}this._editVertices=true;this._layer=_4d.getLayer();this._currentGraphic=_4d;if(_4d.getDojoShape()){_4d.getDojoShape().moveToFront();}this._activateEditToolbar(_4d);},_applyEdits:function(_50,_51){_50=_50||[];if(_50.length<=0){return;}this._edits=_50;var _52=_2.map(_50,function(_53){return _53.layer.applyEdits(_53.adds,_53.updates,_53.deletes);});this._deferredsList=new _2.DeferredList(_52).addCallback(_2.hitch(this,function(){esri.hide(this.progressBar.domNode);if(_51){_51();}var map=this._settings.map;if(map&&map.infoWindow.reposition&&map.infoWindow.isShowing){map.infoWindow.reposition();}}));},_undo:function(){if(this._settings.undoManager&&!this._settings._isApplyEditsCall){this._editToolbar.deactivate();this._undoRedo=true;this._settings.undoManager.undo();}},_redo:function(){if(this._settings.undoManager&&!this._settings._isApplyEditsCall){this._editToolbar.deactivate();this._undoRedo=true;this._settings.undoManager.redo();}},_simplify:function(_54,_55){if(esri.geometry.polygonSelfIntersecting(_54)){this._settings.geometryService.simplify([_54],function(_56){var _57=(_56&&_56.length)?_56[0]:_57;if(_55){_55(_57);}});}else{if(_55){_55(_54);}}},_autoComplete:function(_58,_59){var _5a=this._getLayers("esriGeometryPolygon");var _5b=new esri.tasks.Query();_5b.geometry=_58;_5b.returnGeometry=true;this._selectFeatures(_5a,_5b,_2.hitch(this,function(_5c){if(!_5c||_5c.length<=0){if(_59){_59([_58]);}}else{this._settings.geometryService.autoComplete(esri.getGeometries(_5c),this._toPolylines([_5b.geometry]),function(_5d){if(_59){_59(_5d);}});}}));},_getLayers:function(_5e){var _5f=this._settings.layers;return _2.filter(_5f,function(_60){return _60.geometryType===_5e;});},_selectFeatures:function(_61,_62,_63,_64){this._selectionHelper.selectFeatures(_61,_62,_64||esri.layers.FeatureLayer.SELECTION_NEW,_63);},_updateSelection:function(evt){var _65=evt.mapPoint;var _66=evt.graphic;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,_65,esri.layers.FeatureLayer.SELECTION_NEW,_2.hitch(this,function(_67){var _68=_2.some(_67,_2.hitch(this,function(_69){return _69==_66;}));if(_66&&!_68){var _6a=_66.getLayer();if(this._isValidLayer(_6a)){var _6b=new esri.tasks.Query();_6b.objectIds=[_66.attributes[_6a.objectIdField]];this._selectionHelper.selectFeatures([_6a],_6b,esri.layers.FeatureLayer.SELECTION_ADD,_2.hitch(this,function(_6c){this._updatePopupButtons(_6c);this._onEditFeature(_6c,_65);}));}else{this._clearSelection();}}else{if(_67&&_67.length){this._updatePopupButtons(_67);this._onEditFeature(_67,_65);}else{this._clearSelection();}}}));},_updatePopupButtons:function(_6d){if(!this._usePopup||!_6d){return;}var _6e=_6d.length;var _6f=[this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton];_2.forEach(_6f,_2.hitch(this,function(_70){(_6e>1)?_2.removeClass(_70,"hidden"):_2.addClass(_70,"hidden");}));},_clearSelection:function(_71){this._selectionHelper.clearSelection(_71||false);this._reset();},_findCenterPoint:function(_72){var _73=_72.geometry||_72;var _74;switch(_73.type){case "point":_74=_73;break;case "polyline":var _75=_73.paths[0].length;_74=_73.getPoint(0,Math.ceil(_75/2));break;case "polygon":var _76=_73.rings.length-1;var _77=_73.rings[_76].length-1;_74=_73.getPoint(_76,_77);break;}return this._settings.map.toScreen(_74);},_hideAttributeInspector:function(){if(!this._customAttributeInspector&&this._settings.map.infoWindow){this._settings.map.infoWindow.hide();}},_toPolylines:function(_78){var _79=_2.map(_78,function(_7a){var _7b=new esri.geometry.Polyline(_7a.spatialReference);_2.forEach(_7a.rings,function(_7c){_7b.addPath(_7c);});return _7b;});return _79;},_isNotesFeature:function(_7d){var _7e=_7d.getLayer();var _7f=_7e?_7e.types||null:null;if(!_7f){return false;}var _80=_7d.attributes[_7e.typeIdField];var _81;_2.some(_7f,function(_82){if(_82.id===_80){_81=_82.templates;return true;}return false;});if(!_81){return false;}var _83=_81[0]||null;if(!_83){return false;}var _84=this._isShapeTool(_83.drawingTool)||null;return _84?true:false;},_isValidLayer:function(_85){var _86=this._settings.layerInfos;for(var i=0;i<_86.length;i++){var _87=_86[i];if(_85.id==_87.layerId){return true;}}return false;},_isShapeTool:function(_88){switch(_88){case esri.layers.FeatureTemplate.TOOL_ARROW:return esri.toolbars.Draw.ARROW;case esri.layers.FeatureTemplate.TOOL_LEFT_ARROW:return esri.toolbars.Draw.LEFT_ARROW;case esri.layers.FeatureTemplate.TOOL_RIGHT_ARROW:return esri.toolbars.Draw.RIGHT_ARROW;case esri.layers.FeatureTemplate.TOOL_UP_ARROW:return esri.toolbars.Draw.UP_ARROW;case esri.layers.FeatureTemplate.TOOL_DOWN_ARROW:return esri.toolbars.Draw.DOWN_ARROW;case esri.layers.FeatureTemplate.TOOL_CIRCLE:return esri.toolbars.Draw.CIRCLE;case esri.layers.FeatureTemplate.TOOL_ELLIPSE:return esri.toolbars.Draw.ELLIPSE;case esri.layers.FeatureTemplate.TOOL_TRIANGLE:return esri.toolbars.Draw.TRIANGLE;case esri.layers.FeatureTemplate.TOOL_RECTANGLE:return esri.toolbars.Draw.RECTANGLE;default:return null;}},_toDrawTool:function(_89,_8a){var _8b=_8a.geometryType;switch(_89){case esri.layers.FeatureTemplate.TOOL_POINT:return esri.toolbars.Draw.POINT;case esri.layers.FeatureTemplate.TOOL_ARROW:return esri.toolbars.Draw.ARROW;case esri.layers.FeatureTemplate.TOOL_LEFT_ARROW:return esri.toolbars.Draw.LEFT_ARROW;case esri.layers.FeatureTemplate.TOOL_RIGHT_ARROW:return esri.toolbars.Draw.RIGHT_ARROW;case esri.layers.FeatureTemplate.TOOL_UP_ARROW:return esri.toolbars.Draw.UP_ARROW;case esri.layers.FeatureTemplate.TOOL_DOWN_ARROW:return esri.toolbars.Draw.DOWN_ARROW;case esri.layers.FeatureTemplate.TOOL_CIRCLE:return esri.toolbars.Draw.CIRCLE;case esri.layers.FeatureTemplate.TOOL_ELLIPSE:return esri.toolbars.Draw.ELLIPSE;case esri.layers.FeatureTemplate.TOOL_TRIANGLE:return esri.toolbars.Draw.TRIANGLE;case esri.layers.FeatureTemplate.TOOL_RECTANGLE:return esri.toolbars.Draw.RECTANGLE;case esri.layers.FeatureTemplate.TOOL_LINE:return esri.toolbars.Draw.POLYLINE;case esri.layers.FeatureTemplate.TOOL_POLYGON:return esri.toolbars.Draw.POLYGON;case esri.layers.FeatureTemplate.TOOL_FREEHAND:if(_8b==="esriGeometryPolyline"){return esri.toolbars.Draw.FREEHAND_POLYLINE;}else{return esri.toolbars.Draw.FREEHAND_POLYGON;}break;default:var _8c=esri.toolbars.Draw.POINT;if(_8b==="esriGeometryPolyline"){_8c=esri.toolbars.Draw.POLYLINE;if(this._settings.createOptions.polylineDrawTools[0]===esri.dijit.editing.Editor.CREATE_TOOL_FREEHAND_POLYLINE){_8c=esri.toolbars.Draw.FREEHAND_POLYLINE;}}else{if(_8b==="esriGeometryPolygon"){_8c=esri.toolbars.Draw.POLYGON;if(this._settings.createOptions.polygonDrawTools[0]===esri.dijit.editing.Editor.CREATE_TOOL_FREEHAND_POLYGON){_8c=esri.toolbars.Draw.FREEHAND_POLYGON;}}}return _8c;}},_isModified:function(){var _8d=this._editToolbar.getCurrentState();return ((_8d.isModified||this._attributeChanged)&&_8d.graphic)?_8d.graphic:null;}});_2.mixin(esri.dijit.editing.Editor,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});});