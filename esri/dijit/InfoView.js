/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!esri/dijit/_TouchBase"],function(_1,_2,_3){_2.provide("esri.dijit.InfoView");_2.require("esri.dijit._TouchBase");_2.declare("esri.dijit.InfoView",null,{_items:[],_top:null,_sections:[],_isDecelerate:false,constructor:function(_4,_5){this.container=_2.byId(_5);this._touchBase=esri.dijit._TouchBase(this.container,null);this._slideDiv=_2.create("div",null,this.container,"first");this.events=[];this._items=_4.items;if(_4.sections){this._sections=_4.sections;}_2.addClass(this.container,"esriMobileInfoView");if(this._sections.length===0){_2.create("div",{},this._slideDiv);}else{for(var i=0;i<this._sections.length;i++){var _6=_2.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);_2.create("div",{innerHTML:this._sections[i].title},_6);}}for(var i=0;i<this._items.length;i++){var _7,_8;var _9=0;if(this._items[i].section){_9=this._items[i].section;}switch(this._items[i].type){case "div":_8=_2.create("div",{"class":"esriMobileInfoViewItem",style:this._items[i].style},this._slideDiv.childNodes[_9]);_7=_2.create("div",{innerHTML:this._items[i].text},_8);break;}if(this._items[i].className){_2.addClass(_7,this._items[i].className);}_7._index=i;_7._item=this._items[i];this._items[i]._node=_7;}this.startTouchY=0;},startup:function(){this.onCreate(this._items);this._animateTo(0);},destroy:function(){_2.forEach(this.events,_2.disconnect);this._touchBase=null;_2.query("img",this.container).forEach(function(_a){_a._index=null;_a._item=null;_2.destroy(_a);_a=null;});this._items=null;_2.destroy(this._slideDiv);_2.destroy(this.container);this.container=this._slideDiv=null;},getItems:function(){return this._items;},setPreventDefault:function(_b){this._touchBase.setPreventDefault(_b);},enableTouchScroll:function(){this._touchBase.setPreventDefault(true);this.events.push(_2.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(_2.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(_2.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)";},disableTouchScroll:function(){_2.disconnect(this.events.pop());_2.disconnect(this.events.pop());_2.disconnect(this.events.pop());this._touchBase.setPreventDefault(false);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)";},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0);},onSelect:function(_c){},onUnSelect:function(_d){},onCreate:function(_e){},onClick:function(e){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(e){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date();this.startTouchY=e.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY;},_onTouchMoveHandler:function(e){if(!this._moveDirection){if(Math.abs(e.curY)>Math.abs(e.curX)){this._moveDirection="vertical";}else{this._moveDirection="horizontal";}}if(this._moveDirection==="horizontal"){return;}else{if(this._moveDirection==="vertical"){var _f=e.touches[0].clientY;var _10=_f-this.startTouchY;var _11=_10+this.contentStartOffsetY;this._animateTo(_11);}}},_onTouchEndHandler:function(e){this._endTime=new Date();this._deltaMovement=e.curY;if(this._moveDirection==="vertical"){if(this._shouldStartMomentum()){this._doMomentum();}else{this._snapToBounds();}}else{if(this._moveDirection==="horizontal"){if(e.swipeDirection==="left"){this.onSwipeLeft();}else{if(e.swipeDirection==="right"){this.onSwipeRight();}}}}},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;if(Math.abs(this._velocity)>0.2&&this._diff<200){return true;}else{return false;}},_pullToStop:function(_12){if(Math.abs(_12)>80){_12=_12>0?80:(-contentBox.h+parentBox.h-10)-80;}console.log(_12);this._slideDiv.style.webkitTransition="-webkit-transform 200ms cubic-bezier(0, 0, 1, 1)";var _13=_2.connect(this._slideDiv,"webkitTransitionEnd",this,function(){if(_12>0){this._animateTo(0);}else{this._animateTo(-contentBox.h+parentBox.h-10);}_2.disconnect(_13);});this._animateTo(_12);},_doMomentum:function(){var _14=_2.contentBox(this.container);var _15=this._velocity<0?0.001:-0.001;var _16=-(this._velocity*this._velocity)/(2*_15);var _17=-this._velocity/_15;var p0={x:0,y:0};var p1={x:0,y:0.3};var p2={x:0.6,y:1};var p3={x:1,y:1};var cx=3*(p1.x-p0.x);var bx=3*(p2.x-p1.x)-cx;var ax=p3.x-p0.x-cx-bx;var cy=3*(p1.y-p0.y);var by=3*(p2.y-p1.y)-cy;var ay=p3.y-p0.y-cy-by;var _18=0,_19=0;if(_14.h>this._slideDiv.scrollHeight){this.contentOffsetY=0;_19=300;}else{if(this.contentOffsetY+_16>0){for(var i=0,il=Math.floor(_17/20);i<il;i++){_18=(ax*(i*20)^3)+(bx*(i*20)^2)+cx*(i*20)+p0.x;_18=this._velocity<0?-_18:_18;if(this.contentOffsetY+_18>0){_19=i*20;break;}}if(_19===0){_19=300;}this.contentOffsetY=0;}else{if(Math.abs(this.contentOffsetY+_16)+_14.h>this._slideDiv.scrollHeight){this.contentOffsetY=_14.h-this._slideDiv.scrollHeight;for(var i=0,il=Math.floor(_17/20);i<il;i++){_18=(ax*(i*20)^3)+(bx*(i*20)^2)+cx*(i*20)+p0.x;_18=this._velocity<0?-_18:_18;if(Math.abs(this.contentOffsetY+_18)>this._slideDiv.scrollHeight){_19=i*20;break;}}}else{_19=_17;this.contentOffsetY=this.contentOffsetY+_16;}}}this._slideDiv.style.webkitTransition="-webkit-transform "+_19+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY);},_snapToBounds:function(){var _1a=_2.contentBox(this.container);if(_1a.h>this._slideDiv.scrollHeight){this.contentOffsetY=0;}else{if(this.contentOffsetY>0){this.contentOffsetY=0;}else{if(Math.abs(this.contentOffsetY)+_1a.h>this._slideDiv.scrollHeight){this.contentOffsetY=_1a.h-this._slideDiv.scrollHeight;}}}this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY);},_animateTo:function(_1b){this.contentOffsetY=_1b;this._slideDiv.style.webkitTransform="translate3d(0, "+_1b+"px, 0)";},_stopMomentum:function(){if(this._isDecelerating()){var _1c=document.defaultView.getComputedStyle(this._slideDiv,null);var _1d=new WebKitCSSMatrix(_1c.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(_1d.m42);}},_isDecelerating:function(){if(this.isDecelerate){return true;}else{return false;}},_toggleNode:function(_1e,_1f){if(_1f.toggleState==="ON"){_1f.toggleState="OFF";if(_1f.src){_1e.src=_1f.src.toString();}this.onUnSelect(_1f);}else{_1f.toggleState="ON";if(_1f.srcAlt){_1e.src=_1f.srcAlt;}this.onSelect(_1f);}}});});