/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!dojo/cache,dijit/_Widget,dijit/_Templated,dojox/widget/AnalogGauge,dojox/widget/gauge/AnalogArcIndicator"],function(_1,_2,_3){_2.provide("esri.dijit.Gauge");_2.require("dojo.cache");_2.require("dijit._Widget");_2.require("dijit._Templated");_2.require("dojox.widget.AnalogGauge");_2.require("dojox.widget.gauge.AnalogArcIndicator");_2.declare("esri.dijit.Gauge",[_1._Widget,_1._Templated],{templateString:_2.cache("esri.dijit","templates/Gauge.html","<div class=\"gaugeContainer\">\r\n  <div data-dojo-attach-point=\"titleNode\" class=\"gaugeTitle\">${title}</div>\r\n  <div data-dojo-attach-point=\"dataLabelWrapperNode\">\r\n    <div data-dojo-attach-point=\"dataLabelNode\">${dataLabel}</div>\r\n  </div>\r\n  <div data-dojo-attach-point=\"gaugeNode\" style=\"margin: -10px auto 10px auto; width: 240px; height: 120px;\"></div>\r\n  <div data-dojo-attach-point=\"captionNode\" class=\"gaugeCaption\">${caption}</div>\r\n</div>\r\n"),widgetsInTemplate:false,constructor:function(_4,_5){this.caption="&nbsp;";this.color="#000";this.dataFormat="value";this.maxDataValue=100;this.title="&nbsp;";this.unitLabel="";this.fromWebmap=false;this.feature=null;this.dataLabel="&nbsp;";_2.safeMixin(this,_4);this._majorTicks="";this.value=0;this.numberFormat=this.numberFormat||{"places":0};if(this.fromWebmap){this.dataField=this.field;this.dataFormat=this.valueLabel;this.dataLabelField=this.displayField;this.maxDataValue=this.target;this.unitLabel="";}if(this.dataFormat=="percentage"){this.unitLabel="%";this._majorTicks={offset:90,interval:25,length:3,color:"black"};}this.watch("caption",this._updateCaption);this.watch("dataLabel",this._updateDataLabel);this.watch("title",this._updateTitle);this.watch("value",this._updateValue);this.watch("feature",this._updateFeature);},startup:function(){this.inherited(arguments);var _6=new _3.widget.gauge.AnalogArcIndicator({interactionMode:"gauge",noChange:true,value:this.maxDataValue,width:20,offset:65,color:[204,204,204,1],title:"value",hideValue:true,duration:100});var _7=new _3.widget.gauge.AnalogArcIndicator({interactionMode:"gauge",noChange:false,value:this.value,width:20,offset:65,color:this.color,title:"value",hideValue:true,duration:100});this.gaugeWidget=new _3.widget.AnalogGauge({background:[204,204,204,0],width:parseInt(this.gaugeNode.style.width),height:parseInt(this.gaugeNode.style.height)+10,cx:parseInt(this.gaugeNode.style.width)/2,cy:parseInt(this.gaugeNode.style.height),style:"position: absolute;",radius:parseInt(this.gaugeNode.style.width)/2,useTooltip:false,ranges:[{low:0,high:this.maxDataValue,color:"rgba(255,0,0,0)"}],majorTicks:this._majorTicks,indicators:[_6,_7]},_2.create("div",null,this.gaugeNode));this.gaugeWidget.startup();this.valueNode=_2.create("div",{"innerHTML":"0"+this.unitLabel,"style":{"bottom":parseInt(this.gaugeNode.style.height)-(this.gaugeWidget.cy-20)+"px","color":"#000","font-family":"arial","font-size":"1em","left":"-1000px","position":"absolute"}},this.gaugeWidget.domNode);var _8=_2.contentBox(this.valueNode);_2.style(this.valueNode,"left",this.gaugeWidget.cx+"px");_2.style(this.valueNode,"marginLeft",(-_8.w/2)+"px");if(this.gaugeWidget.cx){_2.style(this.valueNode,"marginBottom",(-_8.h/2)+"px");}if(this.layer){this._connectMouseOver();}},destroy:function(){if(this._mouseOverHandler){_2.disconnect(this._mouseOverHandler);}this.gaugeWidget.destroy();_2.empty(this.domNode);},_connectMouseOver:function(){this._mouseOverHandler=_2.connect(this.layer,"onMouseOver",_2.hitch(this,function(e){this.set("feature",e);}));},_formatValue:function(_9){if(this.dataFormat=="percentage"){_9=Math.round((_9/this.maxDataValue)*100);}return _2.number.format(_9,this.numberFormat);},_updateCaption:function(_a,_b,_c){this.captionNode.innerHTML=_c;},_updateTitle:function(_d,_e,_f){this.titleNode.innerHTML=_f;},_updateValue:function(_10,_11,_12){var val=this._formatValue(_12);this.valueNode.innerHTML=val+this.unitLabel;this.gaugeWidget.indicators[1].update(parseInt(val));},_updateDataLabel:function(_13,_14,_15){this.dataLabelNode.innerHTML=_15;},_updateFeature:function(_16,_17,_18){if(!_18||(_18.hasOwnPropety&&!_18.hasOwnProperty("graphic")&&!_18.declaredClass=="esri.Graphic")){console.log("Gauge Dijit:  a graphic is required to update the gauge.");return;}this.feature=_18.graphic||_18;this.set("value",this.feature.attributes[this.dataField]||0);this.set("dataLabel",this.feature.attributes[this.dataLabelField]||this.noDataLabel);}});});