/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
define(["dijit","dojo","dojox","dojo/require!dojo/io/script,esri/graphic,dojo/_base/url"],function(_1,_2,_3){_2.provide("esri.utils");_2.require("dojo.io.script");_2.require("esri.graphic");_2.require("dojo._base.url");esri.show=function(_4){if(_4){_4.style.display="block";}};esri.hide=function(_5){if(_5){_5.style.display="none";}};esri.toggle=function(_6){_6.style.display=_6.style.display==="none"?"block":"none";};esri.valueOf=function(_7,_8){var i;for(i in _7){if(_7[i]==_8){return i;}}return null;};esri.substitute=(function(){var _9="${*}",_a=["NumberFormat","DateString","DateFormat"];function _b(_c){return esri._isDefined(_c)?_c:"";};function _d(_e,_f,_10){var _11=_10.match(/([^\(]+)(\([^\)]+\))?/i);var _12=_2.trim(_11[1]);var _13=_2.fromJson((_11[2]?_2.trim(_11[2]):"()").replace(/^\(/,"({").replace(/\)$/,"})"));var _14=_f[_e];if(_2.indexOf(_a,_12)===-1){var ref=_2.getObject(_12);if(_2.isFunction(ref)){_14=ref(_14,_e,_f);}}else{if(typeof _14==="number"||(typeof _14==="string"&&_14&&!isNaN(Number(_14)))){_14=Number(_14);switch(_12){case "NumberFormat":if(_2.getObject("dojo.number.format")){return _2.number.format(_14,_13);}break;case "DateString":var _15=new Date(_14);if(_13.local||_13.systemLocale){if(_13.systemLocale){return _15.toLocaleDateString()+(_13.hideTime?"":(" "+_15.toLocaleTimeString()));}else{return _15.toDateString()+(_13.hideTime?"":(" "+_15.toTimeString()));}}else{_15=_15.toUTCString();if(_13.hideTime){_15=_15.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,"");}return _15;}break;case "DateFormat":if(_2.getObject("dojo.date.locale.format")){return _2.date.locale.format(new Date(_14),_13);}break;}}}return _b(_14);};return function(_16,_17,_18){var _19,_1a,_1b;if(esri._isDefined(_18)){if(_2.isObject(_18)){_19=_18.first;_1a=_18.dateFormat;_1b=_18.numberFormat;}else{_19=_18;}}if(!_17||_17===_9){var s=[],val,i;for(i in _16){val=_16[i];if(_1a&&_2.indexOf(_1a.properties||"",i)!==-1){val=_d(i,_16,_1a.formatter||"DateString");}else{if(_1b&&_2.indexOf(_1b.properties||"",i)!==-1){val=_d(i,_16,_1b.formatter||"NumberFormat");}}s.push(i+" = "+_b(val)+"<br/>");if(_19){break;}}return s.join("");}else{return _2.replace(_17,_2.hitch({obj:_16},function(_1c,key){var _1d=key.split(":");if(_1d.length>1){key=_1d[0];_1d.shift();return _d(key,this.obj,_1d.join(":"));}else{if(_1a&&_2.indexOf(_1a.properties||"",key)!==-1){return _d(key,this.obj,_1a.formatter||"DateString");}if(_1b&&_2.indexOf(_1b.properties||"",key)!==-1){return _d(key,this.obj,_1b.formatter||"NumberFormat");}}return _b(this.obj[key]);}),/\$\{([^\}]+)\}/g);}};}());esri.documentBox=_2.isIE?{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}:{w:window.innerWidth,h:window.innerHeight};esri.urlToObject=function(url){var iq=url.indexOf("?");if(iq===-1){return {path:url,query:null};}else{return {path:url.substring(0,iq),query:_2.queryToObject(url.substring(iq+1))};}};esri._getProxyUrl=function(_1e){var _1f=esri.config.defaults.io.proxyUrl,_20,_21,_22;if(!_1f){console.log(esri.bundle.io.proxyNotSet);throw new Error(esri.bundle.io.proxyNotSet);}if(_1e&&window.location.href.toLowerCase().indexOf("https:")!==0){_21=_1f;if(_21.toLowerCase().indexOf("http")!==0){_21=esri._getAbsoluteUrl(_21);}_21=_21.replace(/^http:/i,"https:");if(esri._canDoXOXHR(_21)){_1f=_21;_22=1;}}_20=esri.urlToObject(_1f);_20._xo=_22;return _20;};esri._getProxiedUrl=function(url){if(esri.config.defaults.io.alwaysUseProxy){var _23=esri._getProxyUrl(),_24=esri.urlToObject(url);url=_23.path+"?"+_24.path;var _25=_2.objectToQuery(_2.mixin(_23.query||{},_24.query));if(_25){url+=("?"+_25);}}return url;};esri._hasSameOrigin=function(_26,_27,_28){_26=_26.toLowerCase();_27=_27.toLowerCase();var _29=window.location.href.toLowerCase();_26=_26.indexOf("http")===0?new _2._Url(_26):(_29=new _2._Url(_29));_27=_27.indexOf("http")===0?new _2._Url(_27):(_2.isString(_29)?new _2._Url(_29):_29);return ((_28||(_26.scheme===_27.scheme))&&_26.host===_27.host&&_26.port===_27.port);};esri._canDoXOXHR=function(url,_2a){var _2b=false,_2c=esri._hasSameOrigin,_2d=esri.config.defaults.io.corsEnabledServers,_2e,_2f=-1;if(esri._hasCors&&_2d&&_2d.length){_2b=_2.some(_2d,function(_30,idx){_2e=(_2.trim(_30).toLowerCase().indexOf("http")!==0);if(_2c(url,_2e?("http://"+_30):_30)||(_2e&&_2c(url,"https://"+_30))){_2f=idx;return true;}return false;});}return _2a?_2f:_2b;};esri.request=function(req,_31){var dfd,_32=req.form,_33=_32&&_2.some(_32.elements,function(el){return el.type==="file";}),_34=(req.url.toLowerCase().indexOf("token=")!==-1||(req.content&&req.content.token)||(_33&&_2.some(_32.elements,function(el){return el.name==="token";})))?1:0;esri._detectCors(req.url);if(req._usrDfd){dfd=req._usrDfd;}else{dfd=new _2.Deferred(esri._dfdCanceller);dfd.addBoth(function(_35){if(_35&&(!_2.isIE||!_35.nodeType)){_35._ssl=req._ssl;}});var ld=req.load,_36=req.error;if(ld){dfd.addCallback(function(_37){var _38=dfd._pendingDfd,_39=_38&&_38.ioArgs,_3a=_39&&_39.args;return ld.call(_3a,_37,_39);});}if(_36){dfd.addErrback(function(_3b){var _3c=dfd._pendingDfd,_3d=_3c&&_3c.ioArgs,_3e=_3d&&_3d.args;return _36.call(_3e,_3b,_3d);});}}var _3f=_31&&_31.disableIdentityLookup;if(esri.id&&!_34&&!req._token&&!esri.id._isPublic(req.url)&&!_3f){var _40=esri.id.findCredential(req.url);if(_40){req._token=_40.token;req._ssl=_40.ssl;}}dfd._pendingDfd=esri._request(req,_31,_33);if(!dfd._pendingDfd){dfd.ioArgs=dfd._pendingDfd&&dfd._pendingDfd.ioArgs;var err=new Error("Deferred object is missing");err.log=_2.config.isDebug;req._usrDfd=null;dfd.errback(err);dfd._pendingDfd=null;return dfd;}dfd._pendingDfd.addCallback(function(_41){dfd.ioArgs=dfd._pendingDfd&&dfd._pendingDfd.ioArgs;req._usrDfd=null;dfd.callback(_41);dfd._pendingDfd=null;}).addErrback(function(_42){if(_42&&_42.code==403&&_42.message&&_42.message.toLowerCase().indexOf("ssl")>-1&&_42.message.toLowerCase().indexOf("permission")===-1){if(!req._ssl){req._ssl=req._sslFromServer=true;req._usrDfd=dfd;esri.request(req,_31);return;}}else{if(_42&&_42.status==415){var _43=esri._disableCors(req.url);if(!req._err415){req._err415=1;req._usrDfd=dfd;esri.request(req,_31);return;}}else{if(esri.id&&_2.indexOf(esri.id._errorCodes,_42.code)!==-1&&!esri.id._isPublic(req.url)&&!_3f){dfd._pendingDfd=esri.id.getCredential(req.url,{token:req._token,error:_42});dfd._pendingDfd.addCallback(function(_44){req._token=_44.token;req._usrDfd=dfd;req._ssl=req._sslFromServer||_44.ssl;esri.request(req,_31);}).addErrback(function(_45){req._usrDfd=null;dfd.errback(_45);dfd._pendingDfd=null;});return;}}}dfd.ioArgs=dfd._pendingDfd&&dfd._pendingDfd.ioArgs;req._usrDfd=null;dfd.errback(_42);dfd._pendingDfd=null;});return dfd;};esri._request=function(req,_46,_47){var _48=false,_49=false;if(esri._isDefined(_46)){if(_2.isObject(_46)){_48=!!_46.useProxy;_49=!!_46.usePost;}else{_48=!!_46;}}req=_2.mixin({},req);if(req._ssl){req.url=req.url.replace(/^http:/i,"https:");}var _4a=req.content,_4b=req.url,_4c=_47&&req.form,_4d=esri.config.defaults.io;req.load=function(_4e){var err;if(_4e){if(_4e.error){err=_2.mixin(new Error(),_4e.error);err.log=_2.config.isDebug;}else{if(_4e.status==="error"){err=_2.mixin(new Error(),{code:_4e.code,message:_4e.messages&&_4e.messages.join&&_4e.messages.join(".")});err.log=_2.config.isDebug;}}}return err||_4e;};req.error=function(_4f,io){if(io&&io.xhr){io.xhr.abort();}if(!(_4f instanceof Error)){_4f=_2.mixin(new Error(),_4f);}_4f.log=_2.config.isDebug;_4d.errorHandler(_4f,io);return _4f;};if(req._token){req.content=req.content||{};req.content.token=req._token;}var len=0;if(_4a&&_4b){len=_2.objectToQuery(_4a).length+_4b.length+1;}req.timeout=esri._isDefined(req.timeout)?req.timeout:_4d.timeout;req.handleAs=req.handleAs||"json";try{var _50,_51,_52=esri._reqPreCallback,_53=esri._canDoXOXHR(req.url)&&!(/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i.test(req.url)),_54=(esri._hasSameOrigin(req.url,window.location.href)||_53),_55=(_49||_47||len>_4d.postLength)?true:false,_56=(!_54&&req.handleAs.indexOf("json")!==-1&&req.callbackParamName&&!_47)?true:false,_57=(_4d.alwaysUseProxy||_48||((!_56||_55)&&!_54))?true:false;if(_47&&!esri._hasFileUpload&&!_57&&_53){_57=true;}if(_57){_50=esri._getProxyUrl(_2.trim(_4b).toLowerCase().indexOf("https:")===0);_51=_50.path;if(_50._xo){_53=true;}if(!_55&&(_51.length+1+len)>_4d.postLength){_55=true;}req.url=_51+"?"+_4b;if(_55){req.content=_2.mixin(_50.query||{},_4a);}else{var _58=_2.objectToQuery(_2.mixin(_50.query||{},_4a));if(_58){req.url+=("?"+_58);}req.content=null;}}if(_56&&!_55){if(!esri._isDefined(req.isAsync)&&_2.isFF<4){req.isAsync=true;}return _2.io.script.get(_52?_52(req):req);}else{var _59=req.headers;if(_53&&(!_59||!_59.hasOwnProperty("X-Requested-With"))){_59=req.headers=(_59||{});_59["X-Requested-With"]=null;}if(_47){var _5a=req.callbackParamName||"callback.html",_5b=req.callbackElementName||"textarea",_5c,_5d,_5e,i,il=_4c.elements.length,el;_4a=req.content;if(_4a){for(_5c in _4a){_5e=_4a[_5c];if(esri._isDefined(_5e)){_5d=null;for(i=0;i<il;i++){el=_4c.elements[i];if(el.name===_5c){_5d=el;break;}}if(_5d){_5d.value=_5e;}else{_4c.appendChild(_2.create("input",{type:"hidden",name:_5c,value:_5e}));}}}}if(esri._hasFileUpload){_2.forEach(_4c.elements,function(el){if(el.name===_5a){_4c.removeChild(el);}});req.contentType=false;req.postData=new FormData(_4c);delete req.form;}else{_4c.enctype="multipart/form-data";if(_2.isIE<9){_4c.encoding="multipart/form-data";}_4c.method="post";if(!_2.some(_4c.elements,function(el){return el.name===_5a;})){_4c.appendChild(_2.create("input",{type:"hidden",name:_5a,value:_5b}));}if(_4b.toLowerCase().indexOf("addattachment")!==-1||_4b.toLowerCase().indexOf("updateattachment")!==-1){req.url=_4b+((_4b.indexOf("?")===-1)?"?":"&")+_5a+"="+_5b;if(_57){req.url=_51+"?"+req.url;}}delete req.content;}}req=_52?_52(req):req;if(_55){if(_47&&!esri._hasFileUpload){return _2.io.iframe.send(req);}else{return _2.rawXhrPost(req);}}else{return _2.xhrGet(req);}}}catch(e){var dfd=new _2.Deferred();dfd.errback(req.error(e));return dfd;}};esri._disableCors=function(url){var _5f=esri.config.defaults.io,_60=_5f._processedCorsServers,_61=new _2._Url(url),_62=-1;_61=(_61.host+(_61.port?(":"+_61.port):"")).toLowerCase();_62=esri._canDoXOXHR(url,true);if(_62>-1){_5f.corsEnabledServers.splice(_62,1);}_60[_61]=1;return _62;};esri._detectCors=function(url){var _63=esri.config.defaults.io,_64=_63._processedCorsServers;if(!_63.corsDetection){return;}try{var _65=new _2._Url(url);_65=(_65.host+(_65.port?(":"+_65.port):"")).toLowerCase();if(esri._hasCors&&(url&&url.toLowerCase().indexOf("/rest/services")!==-1)&&(!esri._hasSameOrigin(url,window.location.href)&&!esri._canDoXOXHR(url))&&!_64[_65]){_64[_65]=-1;_2.xhrGet({url:url.substring(0,url.toLowerCase().indexOf("/rest/")+"/rest/".length)+"info",content:{f:"json"},handleAs:"json",headers:{"X-Requested-With":null}}).then(function(_66){if(_66){_64[_65]=2;if(!esri._canDoXOXHR(url)){_63.corsEnabledServers.push(_65);}}else{_64[_65]=1;}},function(_67){_64[_65]=1;});}}catch(e){console.log("esri._detectCors: an unknown error occurred while detecting CORS support");}};esri.setRequestPreCallback=function(_68){esri._reqPreCallback=_68;};esri._getParts=function(arr,obj,cb){return [_2.isString(arr)?arr.split(""):arr,obj||_2.global,_2.isString(cb)?new Function("item","index","array",cb):cb];};esri.filter=function(arr,_69,_6a){var _6b=esri._getParts(arr,_6a,_69),_6c={},i;arr=_6b[0];for(i in arr){if(_6b[2].call(_6b[i],arr[i],i,arr)){_6c[i]=arr[i];}}return _6c;};esri.TileUtils=(function(){function _6d(map,ti,_6e){var wd=map.width,ht=map.height,ew=_6e.xmax-_6e.xmin,eh=_6e.ymax-_6e.ymin,ed=-1,_6f=ti.lods,i,il=_6f.length,abs=Math.abs,lod,cl,ced;for(i=0;i<il;i++){cl=_6f[i];ced=ew>eh?abs(eh-(ht*cl.resolution)):abs(ew-(wd*cl.resolution));if(ed<0||ced<=ed){lod=cl;ed=ced;}else{break;}}return lod;};function _70(map,_71,lod){var res=lod.resolution,cx=(_71.xmin+_71.xmax)/2,cy=(_71.ymin+_71.ymax)/2,_72=(map.width/2)*res,_73=(map.height/2)*res;return new esri.geometry.Extent(cx-(_72),cy-(_73),cx+(_72),cy+(_73),_71.spatialReference);};function _74(map,ti,_75,lod){var res=lod.resolution,tw=ti.width,th=ti.height,to=ti.origin,mv=map.__visibleDelta,_76=Math.floor,tmw=tw*res,tmh=th*res,tr=_76((to.y-_75.y)/tmh),tc=_76((_75.x-to.x)/tmw),_77=to.x+(tc*tmw),_78=to.y-(tr*tmh),oX=_76(Math.abs((_75.x-_77)*tw/tmw))+mv.x,oY=_76(Math.abs((_75.y-_78)*th/tmh))+mv.y;return {point:_75,coords:{row:tr,col:tc},offsets:{x:oX,y:oY}};};return {_addFrameInfo:function(_79,_7a){var _7b,_7c,_7d=2*_7a.origin[1],_7e=_7a.origin[0],_7f=_79.origin.x,_80=_79.width,_81;_2.forEach(_79.lods,function(lod){_7b=Math.round(_7d/lod.resolution);_7c=Math.ceil(_7b/_80);_81=Math.floor((_7e-_7f)/(_80*lod.resolution));if(!lod._frameInfo){lod._frameInfo=[_7c,_81,_81+_7c-1,_7b];}});},getContainingTileCoords:function(ti,_82,lod){var to=ti.origin,res=lod.resolution,tmw=ti.width*res,tmh=ti.height*res,tc=Math.floor((_82.x-to.x)/tmw),tr=Math.floor((to.y-_82.y)/tmh);return {row:tr,col:tc};},getCandidateTileInfo:function(map,ti,_83){var lod=_6d(map,ti,_83),adj=_70(map,_83,lod),ct=_74(map,ti,new esri.geometry.Point(adj.xmin,adj.ymax,_83.spatialReference),lod);return {tile:ct,lod:lod,extent:adj};},getTileExtent:function(ti,_84,row,col){var to=ti.origin,lod=ti.lods[_84],res=lod.resolution,tw=ti.width,th=ti.height;return new esri.geometry.Extent(((col*res)*tw)+to.x,to.y-((row+1)*res)*th,(((col+1)*res)*tw)+to.x,to.y-((row*res)*th),ti.spatialReference);}};}());esri.graphicsExtent=function(_85){var g=_85[0].geometry,_86=g.getExtent(),ext,i,il=_85.length;if(_86===null){_86=new esri.geometry.Extent(g.x,g.y,g.x,g.y,g.spatialReference);}for(i=1;i<il;i++){ext=(g=_85[i].geometry).getExtent();if(ext===null){ext=new esri.geometry.Extent(g.x,g.y,g.x,g.y,g.spatialReference);}_86=_86.union(ext);}if(_86.getWidth()<=0&&_86.getHeight()<=0){return null;}return _86;};esri.getGeometries=function(_87){return _2.map(_87,function(_88){return _88.geometry;});};esri._encodeGraphics=function(_89,_8a){var _8b=[],_8c,enc,_8d;_2.forEach(_89,function(g,i){_8c=g.toJson();enc={};if(_8c.geometry){_8d=_8a&&_8a[i];enc.geometry=_8d&&_8d.toJson()||_8c.geometry;}if(_8c.attributes){enc.attributes=_8c.attributes;}_8b[i]=enc;});return _8b;};esri._serializeLayerDefinitions=function(_8e){var _8f=[],_90=false,re=/[:;]/;if(_8e){_2.forEach(_8e,function(_91,i){if(_91){_8f.push([i,_91]);if(!_90&&re.test(_91)){_90=true;}}});if(_8f.length>0){var _92;if(_90){_92={};_2.forEach(_8f,function(_93){_92[_93[0]]=_93[1];});_92=_2.toJson(_92);}else{_92=[];_2.forEach(_8f,function(_94){_92.push(_94[0]+":"+_94[1]);});_92=_92.join(";");}return _92;}}return null;};esri._serializeTimeOptions=function(_95,ids){if(!_95){return;}var _96=[];_2.forEach(_95,function(_97,i){if(_97){var _98=_97.toJson();if(ids&&_2.indexOf(ids,i)!==-1){_98.useTime=false;}_96.push("\""+i+"\":"+_2.toJson(_98));}});if(_96.length){return "{"+_96.join(",")+"}";}};esri._isDefined=function(_99){return (_99!==undefined)&&(_99!==null);};esri._sanitize=function(obj,_9a){var _9b;if(_9a){for(_9b in obj){if(obj.hasOwnProperty(_9b)){if(obj[_9b]===undefined||obj[_9b]===null){delete obj[_9b];}else{if(obj[_9b] instanceof Object){esri._sanitize(obj[_9b],true);}}}}}else{for(_9b in obj){if(obj.hasOwnProperty(_9b)){if(obj[_9b]===undefined){delete obj[_9b];}}}}return obj;};esri._dfdCanceller=function(dfd){dfd.canceled=true;var _9c=dfd._pendingDfd;if(dfd.fired===-1&&_9c&&_9c.fired===-1){_9c.cancel();}dfd._pendingDfd=null;};esri._fixDfd=function(dfd){var _9d=dfd.then;dfd.then=function(_9e,b,c){if(_9e){var _9f=_9e;_9e=function(_a0){if(_a0&&_a0._argsArray){return _9f.apply(null,_a0);}return _9f(_a0);};}return _9d.call(this,_9e,b,c);};return dfd;};esri._resDfd=function(dfd,_a1,_a2){var _a3=_a1.length;if(_a3===1){if(_a2){dfd.errback(_a1[0]);}else{dfd.callback(_a1[0]);}}else{if(_a3>1){_a1._argsArray=true;dfd.callback(_a1);}else{dfd.callback();}}};esri._createWrappers=function(_a4){var _a5=_2.getObject(_a4+".prototype");_2.forEach(_a5.__msigns,function(sig){var _a6=_a5[sig.n];_a5[sig.n]=function(){var _a7=this,_a8=[],i,_a9=new _2.Deferred(esri._dfdCanceller);if(sig.f){esri._fixDfd(_a9);}for(i=0;i<sig.c;i++){_a8[i]=arguments[i];}var _aa={dfd:_a9};_a8.push(_aa);var _ab,_ac=[],_ad;if(_a7.normalization&&!_a7._isTable){_ab=esri._disassemble(_a8,sig.a);_2.forEach(_ab,function(_ae){_ac=_ac.concat(_ae.value);});if(_ac.length){var sr=_ac[0].spatialReference;if(sr&&sr._isWrappable()){_ad=esri.geometry.normalizeCentralMeridian(_ac,esri.config.defaults.geometryService);}}}if(_ad){_a9._pendingDfd=_ad;_ad.addCallbacks(function(_af){if(_a9.canceled){return;}_aa.assembly=esri._reassemble(_af,_ab);_a9._pendingDfd=_a6.apply(_a7,_a8);},function(err){var _b0=_a7.declaredClass;if(_b0&&_b0.indexOf("FeatureLayer")!==-1){_a7._resolve([err],null,_a8[sig.e],_a9,true);}else{_a7._errorHandler(err,_a8[sig.e],_a9);}});}else{_a9._pendingDfd=_a6.apply(_a7,_a8);}return _a9;};});};esri._disassemble=function(_b1,_b2){var _b3=[];_2.forEach(_b2,function(_b4){var _b5=_b4.i,arg=_b1[_b5],_b6=_b4.p,_b7;if(!_2.isObject(arg)||!arg){return;}if(_b6){if(_b6[0]==="*"){for(_b7 in arg){if(arg.hasOwnProperty(_b7)){esri._addToBucket(arg[_b7],_b3,_b5,_b7);}}}else{_2.forEach(_b6,function(_b8){esri._addToBucket(_2.getObject(_b8,false,arg),_b3,_b5,_b8);});}}else{esri._addToBucket(arg,_b3,_b5);}});return _b3;};esri._addToBucket=function(_b9,_ba,_bb,_bc){var _bd=false,_be;if(_2.isObject(_b9)&&_b9){if(_2.isArray(_b9)){if(_b9.length){_be=_b9[0]&&_b9[0].declaredClass;if(_be&&_be.indexOf("Graphic")!==-1){_b9=_2.map(_b9,function(_bf){return _bf.geometry;});_b9=_2.filter(_b9,esri._isDefined);_bd=_b9.length?true:false;}else{if(_be&&_be.indexOf("esri.geometry.")!==-1){_bd=true;}}}}else{_be=_b9.declaredClass;if(_be&&_be.indexOf("FeatureSet")!==-1){_b9=_2.map(_b9.features||[],function(_c0){return _c0.geometry;});_b9=_2.filter(_b9,esri._isDefined);_bd=_b9.length?true:false;}else{if(_be&&_be.indexOf("esri.geometry.")!==-1){_bd=true;}}}}if(_bd){_ba.push({index:_bb,property:_bc,value:_b9});}};esri._reassemble=function(_c1,_c2){var idx=0,_c3={};_2.forEach(_c2,function(_c4){var _c5=_c4.index,_c6=_c4.property,_c7=_c4.value,len=_c7.length||1;var _c8=_c1.slice(idx,idx+len);if(!_2.isArray(_c7)){_c8=_c8[0];}idx+=len;delete _c4.value;if(_c6){_c3[_c5]=_c3[_c5]||{};_c3[_c5][_c6]=_c8;}else{_c3[_c5]=_c8;}});return _c3;};esri.setScrollable=function(_c9){var _ca=0,_cb=0,_cc=0,_cd=0,_ce=0,_cf=0;return [_2.connect(_c9,"ontouchstart",function(evt){_ca=evt.touches[0].screenX;_cb=evt.touches[0].screenY;_cc=_c9.scrollWidth;_cd=_c9.scrollHeight;_ce=_c9.clientWidth;_cf=_c9.clientHeight;}),_2.connect(_c9,"ontouchmove",function(evt){evt.preventDefault();var _d0=_c9.firstChild;if(_d0 instanceof Text){_d0=_c9.childNodes[1];}var _d1=_d0._currentX||0,_d2=_d0._currentY||0;_d1+=(evt.touches[0].screenX-_ca);if(_d1>0){_d1=0;}else{if(_d1<0&&(Math.abs(_d1)+_ce)>_cc){_d1=-1*(_cc-_ce);}}_d0._currentX=_d1;_d2+=(evt.touches[0].screenY-_cb);if(_d2>0){_d2=0;}else{if(_d2<0&&(Math.abs(_d2)+_cf)>_cd){_d2=-1*(_cd-_cf);}}_d0._currentY=_d2;_2.style(_d0,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+_d1+"px, "+_d2+"px)"});_ca=evt.touches[0].screenX;_cb=evt.touches[0].screenY;})];};esri._getAbsoluteUrl=function(url){if(_2.isString(url)&&url.indexOf("http://")===-1&&url.indexOf("https://")===-1){if(url.indexOf("//")===0){return window.location.protocol+url;}else{if(url.indexOf("/")===0){return window.location.protocol+"//"+window.location.host+url;}else{return esri._appBaseUrl+url;}}}return url;};esri._getDefaultVisibleLayers=function(_d3){var _d4=[],i;if(!_d3){return _d4;}for(i=0;i<_d3.length;i++){if(_d3[i].parentLayerId>=0&&_2.indexOf(_d4,_d3[i].parentLayerId)===-1){continue;}if(_d3[i].defaultVisibility){_d4.push(_d3[i].id);}}return _d4;};esri._getLayersForScale=function(_d5,_d6){var _d7=[];if(_d5>0&&_d6){var i;for(i=0;i<_d6.length;i++){if(_d6[i].parentLayerId>=0&&_2.indexOf(_d7,_d6[i].parentLayerId)===-1){continue;}if(_d6[i].id>=0){var _d8=true,_d9=_d6[i].maxScale,_da=_d6[i].minScale;if(_d9>0||_da>0){if(_d9>0&&_da>0){_d8=_d9<=_d5&&_d5<=_da;}else{if(_d9>0){_d8=_d9<=_d5;}else{if(_da>0){_d8=_d5<=_da;}}}}if(_d8){_d7.push(_d6[i].id);}}}}return _d7;};});